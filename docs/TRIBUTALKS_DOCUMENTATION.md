# TribuTalks ‚Äî Documenta√ß√£o Completa para Empres√°rio/Dev

> **√öltima atualiza√ß√£o:** 4 de Fevereiro de 2026

## Resumo Executivo

O TribuTalks √© uma **plataforma SaaS de intelig√™ncia tribut√°ria AI-Native** voltada para CEOs e CFOs de empresas com faturamento acima de R$ 1 milh√£o/m√™s. A plataforma ajuda empresas a se prepararem para a **Reforma Tribut√°ria brasileira** (2026-2033), oferecendo simuladores, diagn√≥sticos, IA assistente com mem√≥ria evolutiva, agentes especializados e comunidade.

### Diferenciais AI-Native

| Caracter√≠stica | Implementa√ß√£o |
|----------------|---------------|
| **Agentes Especializados** | 3 agentes (Fiscal, Margem, Compliance) com routing inteligente |
| **Mem√≥ria Evolutiva** | Clara aprende padr√µes e prefer√™ncias de cada usu√°rio |
| **A√ß√µes Aut√¥nomas** | Sistema de triggers que executa tarefas automaticamente |
| **Feedback Loop (RLHF)** | Coleta thumbs up/down para fine-tuning futuro |
| **Insights Proativos** | Sistema detecta problemas e gera alertas autom√°ticos |
| **Contexto Rico** | Dados reais do usu√°rio (DRE, Score, cr√©ditos) injetados no prompt |
| **Aprendizado Cont√≠nuo** | Cada intera√ß√£o alimenta base de treinamento propriet√°ria |
| **RAG H√≠brido** | Busca vetorial (70%) + keywords (30%) para m√°xima precis√£o |
| **Knowledge Graph** | Mapeamento de rela√ß√µes NCM ‚Üî tributos ‚Üî benef√≠cios |

---

# PARTE 1: VIS√ÉO DO EMPRES√ÅRIO

## Proposta de Valor

| Problema | Solu√ß√£o TribuTalks |
|----------|-------------------|
| Reforma Tribut√°ria complexa (EC 132/2023, LC 214/2025) | Plataforma com timeline, calculadoras e alertas |
| Falta de visibilidade sobre impacto no caixa | NEXUS: 8 KPIs em tempo real |
| Cr√©ditos tribut√°rios n√£o aproveitados | Radar de Cr√©ditos (24 regras automatizadas) |
| Precifica√ß√£o sem considerar novos impostos | PriceGuard com gross-up reverso |
| D√∫vidas tribut√°rias fora do hor√°rio comercial | Clara AI 24/7 com agentes especializados |

---

## Planos e Pre√ßos (2027)

| Plano | Pre√ßo | CNPJs | Usu√°rios | Destaques |
|-------|-------|-------|----------|-----------|
| **STARTER** | R$ 397/m√™s ou R$ 3.970/ano | 1 | 1 | Clara AI (30 msgs/dia), Score, Split Payment, Calculadora RTC |
| **NAVIGATOR** | R$ 1.297/m√™s | 2 | 2 | + Not√≠cias, Timeline, Workflows, Comunidade Circle |
| **PROFESSIONAL** | R$ 2.997/m√™s | 5 | 4 | + XMLs, Radar Cr√©ditos, DRE, NEXUS, 61+ Oportunidades, ERP |
| **ENTERPRISE** | Sob consulta | ‚àû | ‚àû | + Consultoria jur√≠dica (Rebechi & Silva), White Label, API |

> **Nota:** Apenas o plano Starter possui op√ß√£o anual (economia de 2 meses).

---

## Ferramentas por Categoria (36 total)

### Etapa 1: ENTENDER
| Ferramenta | Descri√ß√£o | Plano M√≠nimo |
|------------|-----------|--------------|
| Score Tribut√°rio | Avalia sa√∫de fiscal em 11 perguntas (nota A+ a E) | FREE |
| Timeline 2026-2033 | Calend√°rio de marcos da Reforma | FREE |
| Not√≠cias da Reforma | Feed curado + "P√≠lula do Dia" | NAVIGATOR |

### Etapa 2: SIMULAR
| Ferramenta | Descri√ß√£o | Plano M√≠nimo |
|------------|-----------|--------------|
| Simulador Split Payment | Impacto no fluxo de caixa | FREE |
| Comparativo de Regimes | Simples vs Presumido vs Real | FREE |
| Calculadora RTC (NCM) | CBS + IBS + IS por produto | FREE |
| Calculadora NBS (Servi√ßos) | Novos tributos para servi√ßos (LC 214/2025) | NAVIGATOR |

### Etapa 3: DIAGNOSTICAR
| Ferramenta | Descri√ß√£o | Plano M√≠nimo |
|------------|-----------|--------------|
| DRE Inteligente | Demonstrativo + impacto da Reforma no lucro | PROFESSIONAL |
| Radar de Cr√©ditos | 24 regras que identificam cr√©ditos em XMLs | PROFESSIONAL |
| Motor de Oportunidades | 61+ incentivos fiscais mapeados | PROFESSIONAL |
| Suite Margem Ativa | OMC-AI (compras) + PriceGuard (vendas) | PROFESSIONAL |

### Etapa 4: COMANDAR
| Ferramenta | Descri√ß√£o | Plano M√≠nimo |
|------------|-----------|--------------|
| NEXUS | 8 KPIs consolidados + insights autom√°ticos | PROFESSIONAL |
| Painel Executivo | Relat√≥rios PDF + consultoria jur√≠dica | ENTERPRISE |

### EXTRAS
| Ferramenta | Descri√ß√£o | Plano M√≠nimo |
|------------|-----------|--------------|
| Clara AI | Copiloto tribut√°rio com agentes especializados | STARTER |
| Analisador de Documentos | IA analisa contratos | NAVIGATOR |
| Workflows Guiados | Jornadas estruturadas (4 roteiros) | NAVIGATOR |
| Comunidade Circle | Network + f√≥runs + lives | NAVIGATOR |
| Checklist da Reforma | Avalia prontid√£o operacional | NAVIGATOR |

---

## Clara AI ‚Äî Sistema de Agentes Especializados

A Clara utiliza uma arquitetura AI-Native com 3 agentes especializados que colaboram:

### Agentes

| Agente | Dom√≠nio | Capabilities |
|--------|---------|--------------|
| **Fiscal** | Cr√©ditos, NCM, obriga√ß√µes | An√°lise de cr√©ditos, classifica√ß√£o NCM, compliance fiscal |
| **Margem** | DRE, pricing, custos | Prote√ß√£o de margem, simula√ß√£o de pre√ßos, an√°lise de custos |
| **Compliance** | Prazos, reforma, regulat√≥rio | Monitoramento de deadlines, alertas de mudan√ßas, adequa√ß√£o |

### Tom e Comunica√ß√£o

A Clara segue princ√≠pios r√≠gidos de comunica√ß√£o:

| Regra | Descri√ß√£o |
|-------|-----------|
| **Brevidade Extrema** | Pergunta simples: 2-3 linhas NO M√ÅXIMO |
| **Resposta Direta** | Primeira frase = resposta direta (sem pre√¢mbulo) |
| **Tom Conversacional** | Amiga expert, n√£o rob√¥ formal |
| **Personaliza√ß√£o** | Usa nome do usu√°rio, referencia dados reais |
| **Proibi√ß√µes** | Nunca diz "√ìtima pergunta!", "Claro!", etc. |

### Insights Proativos

| Tipo | Exemplos |
|------|----------|
| **Alertas** | Score abaixo de 50, margem cr√≠tica |
| **Recomenda√ß√µes** | Recalcular Score ap√≥s 30 dias, importar mais XMLs |
| **Oportunidades** | Cr√©ditos acima de R$ 10k identificados |
| **Riscos** | Impacto negativo da Reforma na margem |

Os insights aparecem no Dashboard com CTAs diretos para a√ß√£o.

---

## Onboarding Conversacional

O onboarding √© uma experi√™ncia **AI-First** onde a Clara guia o usu√°rio:

1. **Sauda√ß√£o personalizada** por hor√°rio (Bom dia/tarde/noite)
2. **Busca autom√°tica de CNPJ** ‚Äî preenche empresa, estado e CNAE
3. **Perguntas conversacionais** ‚Äî regime, faturamento, setor
4. **Confirma√ß√£o visual** ‚Äî resumo dos dados antes de salvar
5. **Celebra√ß√£o** ‚Äî confetti e direcionamento ao Score

### Gamifica√ß√£o

| Elemento | Descri√ß√£o | Planos |
|----------|-----------|--------|
| **Achievements** | 14 badges por uso de ferramentas | Starter, Navigator |
| **Streaks** | Dias consecutivos de acesso | Starter, Navigator |
| **First Mission** | Miss√£o inicial por regime tribut√°rio | Todos |

> **Nota:** Para Professional/Enterprise, gamifica√ß√£o √© secund√°ria ‚Äî foco em resultados executivos (NEXUS).

---

## Sistema de Notifica√ß√µes

| Tipo | Descri√ß√£o |
|------|-----------|
| Sino no Header | Contador de n√£o lidas + lista de notifica√ß√µes |
| Categorias | geral, reforma, indicacao, sistema |
| Realtime | Sincroniza√ß√£o instant√¢nea via WebSocket |
| E-mails | Apenas m√©tricas di√°rias (admin) e contatos diretos |

---

## Programa de Indica√ß√£o

| Indica√ß√µes Qualificadas | Desconto |
|-------------------------|----------|
| 1+ | 5% |
| 3+ | 10% |
| 5+ | 15% |
| 10+ | 20% |

- C√≥digo √∫nico no formato `TRIBXXXX`
- Link de indica√ß√£o para `/cadastro?ref=CODIGO`
- Status: pending ‚Üí qualified (30 dias pagos) ‚Üí rewarded

---

## Comunidade e Acessos

| Plano | Acesso |
|-------|--------|
| NAVIGATOR | Grupo de WhatsApp |
| PROFESSIONAL+ | Circle (Intelig√™ncia Tribut√°ria Connect) |

Ao assinar Professional, o usu√°rio recebe automaticamente:
- E-mail de boas-vindas via Resend
- Link pessoal para entrar na comunidade Circle
- Tag `professional_subscriber` no Beehiiv (para automa√ß√µes)

---

## Valuation Empresarial

A plataforma calcula o valor da empresa usando:

```
Valuation = (EBITDA Mensal √ó 12) √ó M√∫ltiplo Setorial √ó Ajuste de Compliance
```

| Fator | Range |
|-------|-------|
| **M√∫ltiplo Setorial** | 4.0x a 7.0x |
| **Ajuste Score** | -30% (Nota E) a +15% (Nota A) |

O sistema rastreia hist√≥rico de valuation e alerta quando compliance impacta negativamente.

---

## Roadmap 2026+

| Feature | Status |
|---------|--------|
| Agentes Especializados (Fiscal, Margem, Compliance) | ‚úÖ Implementado |
| Mem√≥ria Evolutiva | ‚úÖ Implementado |
| A√ß√µes Aut√¥nomas | ‚úÖ Implementado |
| RAG H√≠brido (vetorial + keywords) | ‚úÖ Implementado |
| Knowledge Graph Tribut√°rio | ‚úÖ Implementado |
| Onboarding Conversacional | ‚úÖ Implementado |
| Fine-tuning da Clara com dados coletados | Em coleta |
| Reward Model (RLHF local) | Planejado |
| App Mobile (iOS/Android) | Planejado |
| Orquestra√ß√£o MCP | Planejado |

---

# PARTE 2: VIS√ÉO T√âCNICA (DEV)

## Stack Tecnol√≥gico

| Camada | Tecnologia |
|--------|------------|
| Frontend | React 18 + Vite + TypeScript |
| Estiliza√ß√£o | Tailwind CSS + shadcn/ui |
| Estado | TanStack Query + Context API |
| Backend | Supabase (Lovable Cloud) |
| Edge Functions | Deno (Supabase Functions) |
| AI | Claude Sonnet 4 + Gemini 2.5 Flash via Lovable AI |
| Pagamentos | Stripe (subscriptions + one-off) |
| E-mail | Resend (transacional) + Beehiiv (newsletter) |
| Comunidade | Circle.so |
| PWA | vite-plugin-pwa |

---

## Arquitetura AI-Native (v7)

### Diagrama Geral

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                           CLARA AI SYSTEM                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ                    ORQUESTRADOR CENTRAL                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ     ‚îÇ FISCAL AGENT ‚îÇ ‚îÇ MARGIN AGENT ‚îÇ ‚îÇ COMPLIANCE   ‚îÇ            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ     ‚îÇ              ‚îÇ ‚îÇ              ‚îÇ ‚îÇ AGENT        ‚îÇ            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ     ‚îÇ ‚Ä¢ Cr√©ditos   ‚îÇ ‚îÇ ‚Ä¢ DRE        ‚îÇ ‚îÇ ‚Ä¢ Prazos     ‚îÇ            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ     ‚îÇ ‚Ä¢ NCM        ‚îÇ ‚îÇ ‚Ä¢ Pricing    ‚îÇ ‚îÇ ‚Ä¢ Reforma    ‚îÇ            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ     ‚îÇ ‚Ä¢ Compliance ‚îÇ ‚îÇ ‚Ä¢ Custos     ‚îÇ ‚îÇ ‚Ä¢ Adequa√ß√£o  ‚îÇ            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ            ‚îÇ                ‚îÇ                ‚îÇ                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                             ‚îÇ                                      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                     ‚îÇ    ROUTER     ‚îÇ                              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                     ‚îÇ (keyword +    ‚îÇ                              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                     ‚îÇ  context)     ‚îÇ                              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                              ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ                     RAG H√çBRIDO                                    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ Busca        ‚îÇ  ‚îÇ   Busca      ‚îÇ  ‚îÇ Knowledge Graph          ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ Vetorial     ‚îÇ  ‚îÇ   Keywords   ‚îÇ  ‚îÇ (NCM ‚Üî Tributos)         ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ (70%)        ‚îÇ  ‚îÇ   (30%)      ‚îÇ  ‚îÇ                          ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Cache de Embeddings: Reutiliza vetores j√° calculados              ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ                     MEM√ìRIA EVOLUTIVA                              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ Prefer√™ncias ‚îÇ  ‚îÇ   Padr√µes    ‚îÇ  ‚îÇ Decis√µes do Usu√°rio      ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ (confidence) ‚îÇ  ‚îÇ  Detectados  ‚îÇ  ‚îÇ (hist√≥rico)              ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Confidence Score: 0.1 ‚Üí 0.95 (aumenta com refor√ßo)               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Decay Rate: Padr√µes antigos perdem relev√¢ncia                     ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ                     A√á√ïES AUT√îNOMAS                                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Triggers:                                                          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ xml_imported ‚Üí analyze_credits (auto)                           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ score_below_60 ‚Üí compliance_alert (auto)                        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ margin_drop_5pp ‚Üí margin_alert (auto)                           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ deadline_7_days ‚Üí send_reminder (auto)                          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ benefit_expiring ‚Üí alert_expiration (auto)                      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ dre_updated ‚Üí recalculate_valuation (auto)                      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Status: pending ‚Üí approved ‚Üí executed                              ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Priority: low | medium | high | urgent                             ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ                     DATA FLYWHEEL (RLHF)                           ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ Feedback     ‚îÇ  ‚îÇ   Training   ‚îÇ  ‚îÇ Export JSONL             ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ Buttons üëçüëé  ‚îÇ‚Üí ‚îÇ   Center     ‚îÇ‚Üí ‚îÇ (Fine-tuning)            ‚îÇ ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Future: Reward Model local para ranking pr√©-envio                 ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Tabelas AI-Native

| Tabela | Descri√ß√£o | Uso |
|--------|-----------|-----|
| `clara_agents` | Configura√ß√£o dos agentes especializados | Capabilities, triggers, prioridades |
| `clara_autonomous_actions` | Fila de a√ß√µes aut√¥nomas | Triggers, payloads, status, resultados |
| `clara_user_decisions` | Decis√µes do usu√°rio rastreadas | Contexto, op√ß√µes, escolha, feedback |
| `clara_learned_patterns` | Padr√µes aprendidos por usu√°rio | Tipo, valor, confidence, decay |
| `clara_memory` | Mem√≥rias de longo prazo | Contexto, import√¢ncia, refor√ßos |
| `clara_conversations` | Hist√≥rico de todas as conversas | Continuidade de contexto |
| `clara_feedback` | Avalia√ß√µes üëçüëé das respostas | Base para fine-tuning (RLHF) |
| `clara_insights` | Insights proativos gerados | Alertas autom√°ticos |
| `clara_knowledge_base` | Base de conhecimento jur√≠dico | RAG / Inje√ß√£o de contexto |
| `clara_cache` | Cache de respostas frequentes | Economia de tokens |
| `clara_embeddings_cache` | Cache de vetores calculados | Economia de API calls |

### Hooks AI-Native

```typescript
// src/hooks/clara/index.ts

// Agentes Especializados
export { useClaraAgents, useFiscalAgent, useMarginAgent, useComplianceAgent } from './useClaraAgents';
export { useClaraAgentIntegration } from './useClaraAgentIntegration';

// Mem√≥ria Evolutiva e Aprendizado
export { useClaraLearning, useClaraContextMemory } from './useClaraLearning';

// A√ß√µes Aut√¥nomas
export { useClaraAutonomousActions, AUTO_TRIGGERS } from './useClaraAutonomousActions';

// Triggers de Eventos
export { useClaraTrigger } from './useClaraTrigger';

// Knowledge Graph
export { useKnowledgeGraph } from './useKnowledgeGraph';

// Busca Sem√¢ntica
export { useSemanticSearch } from './useSemanticSearch';
```

### Componentes AI-Native

```typescript
// src/components/clara/index.ts

export { ClaraAgentBadge } from './ClaraAgentBadge';           // Badge do agente ativo
export { ClaraAutonomousActionCard } from './ClaraAutonomousActionCard';  // Card de a√ß√£o
export { ClaraAutonomousPanel } from './ClaraAutonomousPanel';  // Painel de a√ß√µes pendentes
export { ClaraFeedbackButtons } from './ClaraFeedbackButtons';  // Thumbs up/down
export { ClaraInsightCard } from './ClaraInsightCard';          // Card de insight
export { ClaraInsightsPanel } from './ClaraInsightsPanel';      // Painel de insights
export { ClaraActionsDrawer } from './ClaraActionsDrawer';      // Drawer lateral de a√ß√µes
```

### Sistema de Triggers

```typescript
// useClaraTrigger.ts - M√©todos dispon√≠veis

const { triggers } = useClaraTrigger();

// Disparar ap√≥s importa√ß√£o de XMLs
await triggers.xmlImported(10); // 10 XMLs importados

// Disparar quando score cai abaixo do limiar
await triggers.scoreBelowThreshold(55);

// Disparar quando margem cai mais que 5pp
await triggers.marginDrop(5.2);

// Disparar ap√≥s atualiza√ß√£o do DRE
await triggers.dreUpdated({ lucroLiquido: 50000, margemLiquida: 8.5 });
```

### RAG H√≠brido

```typescript
// Configura√ß√£o de busca
const SEARCH_CONFIG = {
  vectorWeight: 0.7,      // 70% similaridade vetorial
  keywordWeight: 0.3,     // 30% match de keywords
  minSimilarity: 0.65,    // Threshold m√≠nimo
  maxResults: 10,
};

// Prioridades de fonte
const SOURCE_PRIORITY = {
  'user_memory': 1.3,     // +30% boost para mem√≥rias do usu√°rio
  'knowledge_base': 1.0,  // Base padr√£o
  'general': 0.8,         // -20% para conte√∫do gen√©rico
};
```

---

## Estrutura de Arquivos

```text
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/                    # shadcn/ui (50+ componentes)
‚îÇ   ‚îú‚îÄ‚îÄ landing/               # P√°gina de vendas (3 jornadas)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ InteractiveDemo.tsx    # Demo interativa com 5 fases
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ demo/                  # Componentes de cada fase
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ DemoStepUpload.tsx   # Fase 1: Upload XMLs (5s)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ DemoStepScore.tsx    # Fase 2: Score Tribut√°rio (7s)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ DemoStepRadar.tsx    # Fase 3: Radar de Cr√©ditos (7s)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ DemoStepClara.tsx    # Fase 4: Clara AI (8s)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ DemoStepNexus.tsx    # Fase 5: Dashboard NEXUS (manual)
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/             # Layout + cards do dashboard
‚îÇ   ‚îú‚îÄ‚îÄ clara/                 # Componentes AI-Native
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClaraAgentBadge.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClaraAutonomousActionCard.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClaraAutonomousPanel.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClaraActionsDrawer.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClaraFeedbackButtons.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClaraInsightCard.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ClaraInsightsPanel.tsx
‚îÇ   ‚îú‚îÄ‚îÄ nexus/                 # NEXUS Command Center
‚îÇ   ‚îú‚îÄ‚îÄ credits/               # Radar de Cr√©ditos
‚îÇ   ‚îú‚îÄ‚îÄ dre/                   # DRE Inteligente
‚îÇ   ‚îú‚îÄ‚îÄ onboarding/            # Onboarding Conversacional
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClaraOnboardingChat.tsx   # Chat principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FirstMission.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GuidedTour.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ OnboardingChecklist.tsx
‚îÇ   ‚îú‚îÄ‚îÄ achievements/          # Badges e Streaks
‚îÇ   ‚îú‚îÄ‚îÄ referral/              # Programa de Indica√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ common/                # Componentes compartilhados
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.tsx          # Home logada (com InsightsPanel)
‚îÇ   ‚îú‚îÄ‚îÄ Nexus.tsx              # Centro de Comando
‚îÇ   ‚îú‚îÄ‚îÄ ClaraAI.tsx            # Interface Clara AI (com Feedback)
‚îÇ   ‚îú‚îÄ‚îÄ OnboardingAI.tsx       # Onboarding conversacional
‚îÇ   ‚îú‚îÄ‚îÄ Indicar.tsx            # Programa de Indica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ calculadora/           # Calculadoras (RTC, NBS, Split)
‚îÇ   ‚îî‚îÄ‚îÄ admin/
‚îÇ       ‚îú‚îÄ‚îÄ AdminDashboard.tsx
‚îÇ       ‚îú‚îÄ‚îÄ AdminTrainingData.tsx  # Training Data Center
‚îÇ       ‚îú‚îÄ‚îÄ AdminRAGDashboard.tsx  # Dashboard do RAG
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useAuth.tsx            # Autentica√ß√£o + perfil
‚îÇ   ‚îú‚îÄ‚îÄ clara/                 # Hooks AI-Native
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useClaraAgents.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useClaraAgentIntegration.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useClaraLearning.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useClaraAutonomousActions.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useClaraTrigger.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useKnowledgeGraph.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useSemanticSearch.ts
‚îÇ   ‚îú‚îÄ‚îÄ useClaraMemory.ts
‚îÇ   ‚îú‚îÄ‚îÄ useClaraContext.ts
‚îÇ   ‚îú‚îÄ‚îÄ useNexusData.ts
‚îÇ   ‚îú‚îÄ‚îÄ useReferral.ts
‚îÇ   ‚îú‚îÄ‚îÄ useNotifications.ts
‚îÇ   ‚îú‚îÄ‚îÄ useAchievements.ts
‚îÇ   ‚îî‚îÄ‚îÄ useFeatureAccess.ts
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ toolsManual.ts         # Base de conhecimento (18 ferramentas)
‚îÇ   ‚îî‚îÄ‚îÄ checklistReformaItems.ts
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ site.ts                # Links Stripe, contatos
‚îî‚îÄ‚îÄ integrations/
    ‚îî‚îÄ‚îÄ supabase/
        ‚îú‚îÄ‚îÄ client.ts          # Cliente Supabase
        ‚îî‚îÄ‚îÄ types.ts           # Tipos gerados automaticamente
```

---

## Supabase Functions (Edge Functions)

| Fun√ß√£o | Descri√ß√£o |
|--------|-----------|
| `clara-assistant` | Orquestra Clara AI (Claude/Gemini) + salva conversas + extrai mem√≥rias |
| `generate-clara-insights` | Analisa dados e gera insights proativos |
| `trigger-autonomous-actions` | Processa eventos e cria a√ß√µes aut√¥nomas |
| `process-autonomous-cron` | Executa a√ß√µes aprovadas em batch |
| `execute-autonomous-action` | Executa uma a√ß√£o espec√≠fica |
| `semantic-search` | Busca h√≠brida vetorial + keywords |
| `generate-embeddings` | Gera vetores para RAG |
| `populate-embeddings` | Popula embeddings da knowledge base |
| `memory-decay` | Aplica decay em padr√µes antigos |
| `stripe-webhook` | Processa assinaturas Stripe + envia welcome email |
| `calculate-rtc` | Calcula CBS/IBS/IS via API Gov |
| `calculate-tax-score` | Gera score tribut√°rio (0-1000) |
| `analyze-credits` | Identifica cr√©ditos em XMLs |
| `process-xml-batch` | Processa lote de XMLs |
| `process-dre` | Calcula DRE + impacto reforma |
| `match-opportunities` | Matching perfil √ó 61 oportunidades |
| `erp-sync` | Sincroniza Omie, Bling, Conta Azul |
| `contaazul-oauth` | OAuth 2.0 para Conta Azul |
| `send-executive-report` | Gera relat√≥rio PDF executivo |
| `fetch-news` | Busca not√≠cias de fontes tribut√°rias |
| `process-referral-rewards` | Aplica descontos de indica√ß√£o |
| `subscribe-newsletter` | Integra Beehiiv |

---

## Tabelas Supabase (Principais)

### Core
| Tabela | Descri√ß√£o |
|--------|-----------|
| `profiles` | Usu√°rios + plano + stripe/mp IDs |
| `company_profile` | Perfil completo da empresa (100+ campos) |
| `company_dre` | DREs + c√°lculos + impacto reforma |
| `tax_score` | Score tribut√°rio + dimens√µes |

### AI-Native
| Tabela | Descri√ß√£o |
|--------|-----------|
| `clara_agents` | Configura√ß√£o dos agentes especializados |
| `clara_autonomous_actions` | Fila de a√ß√µes aut√¥nomas com triggers |
| `clara_user_decisions` | Decis√µes rastreadas para aprendizado |
| `clara_learned_patterns` | Padr√µes aprendidos (prefer√™ncias, comportamentos) |
| `clara_memory` | Mem√≥rias de longo prazo (contexto, decis√µes, prefer√™ncias) |
| `clara_conversations` | Hist√≥rico de conversas (user + assistant) |
| `clara_feedback` | Avalia√ß√µes de respostas (positive, negative, neutral) |
| `clara_insights` | Insights proativos (alertas, recomenda√ß√µes, riscos) |
| `clara_knowledge_base` | Base de conhecimento jur√≠dico/fiscal |
| `clara_cache` | Cache de respostas frequentes |
| `clara_embeddings_cache` | Cache de vetores (economia de API) |

### Operacional
| Tabela | Descri√ß√£o |
|--------|-----------|
| `identified_credits` | Cr√©ditos encontrados nos XMLs |
| `company_opportunities` | Match usu√°rio √ó oportunidades |
| `notifications` | Sistema de notifica√ß√µes |
| `referral_codes` | C√≥digos de indica√ß√£o |
| `referrals` | Registro de indica√ß√µes |
| `erp_connections` | Conex√µes com ERPs |
| `erp_sync_logs` | Logs de sincroniza√ß√£o |

---

## Clara AI ‚Äî Prompt Architecture

### Regras de Brevidade (CR√çTICO)

```typescript
// Regras obrigat√≥rias no prompt da Clara

const BREVITY_RULES = `
## REGRA #1 ‚Äî BREVIDADE EXTREMA (OBRIGAT√ìRIO)
- Pergunta simples: 2-3 linhas NO M√ÅXIMO
- Pergunta t√©cnica: 4-5 linhas NO M√ÅXIMO
- Primeira frase = resposta DIRETA (sem pre√¢mbulo)
- PROIBIDO: "√ìtima pergunta!", "Claro!", "Com certeza!"

## REGRA #2 ‚Äî TOM CONVERSACIONAL
- Voc√™ √© uma AMIGA expert, n√£o um rob√¥
- Use o NOME do usu√°rio sempre que dispon√≠vel
- Express√µes naturais: "Olha s√≥...", "Na pr√°tica...", "O pulo do gato √©..."
- Emojis: m√°ximo 1 por resposta, nunca no in√≠cio
`;
```

### Inje√ß√£o de Contexto

```typescript
// Dados reais do usu√°rio injetados no prompt

const USER_CONTEXT = `
‚≠ê PLANO ATUAL: ${profile.plan} (USE ESTA INFORMA√á√ÉO!)

üìä DADOS DA EMPRESA:
- Empresa: ${company.nome_fantasia}
- Regime: ${company.regime_tributario}
- Faturamento: ${formatCurrency(company.faturamento_mensal)}/m√™s
- Score Tribut√°rio: ${score.nota} (${score.valor}/1000)

üí∞ DRE MAIS RECENTE:
- Receita: ${formatCurrency(dre.receita_bruta)}
- Margem L√≠quida: ${dre.margem_liquida}%
- Impacto Reforma: ${formatCurrency(dre.impacto_reforma)}

üéØ CR√âDITOS IDENTIFICADOS:
- Total Potencial: ${formatCurrency(credits.total)}
- Alta Confian√ßa: ${formatCurrency(credits.alta)}
`;
```

### Guardrails

- **Limite OAB**: Nunca emite parecer jur√≠dico
- **Prote√ß√£o anti-jailbreak**: Ignora tentativas de override
- **Linguagem de cen√°rio**: "Este cen√°rio tende a..." em vez de "Voc√™ deve..."
- **Plano correto**: Sempre usa o plano do contexto, nunca inventa

---

## Sistema de Autentica√ß√£o

```typescript
// useAuth.tsx
interface AuthContextType {
  user: User | null;
  session: Session | null;
  profile: Profile | null;
  loading: boolean;
  signUp: (email, password, nome) => Promise<void>;
  signIn: (email, password) => Promise<void>;
  signInWithMagicLink: (email) => Promise<void>;
  signInWithGoogle: () => Promise<void>;
  signOut: () => Promise<void>;
  refreshProfile: () => Promise<void>;
}
```

- Supabase Auth (email/password, magic link, OAuth Google)
- Perfil carregado automaticamente ap√≥s login
- `ProtectedRoute.tsx` garante onboarding completo

---

## Controle de Acesso

```typescript
// useFeatureAccess.ts

// Navega√ß√£o adaptativa por plano:
// - Starter: 5 ferramentas b√°sicas
// - Navigator: 7 ativas + 3 Pro travadas (com preview)
// - Professional: NEXUS-first + todas liberadas

// Componente FeatureGate
<FeatureGate feature="nexus" fallback={<UpgradePrompt />}>
  <NexusPage />
</FeatureGate>
```

---

## NEXUS ‚Äî 8 KPIs

```typescript
interface NexusKpiData {
  fluxoCaixa: { valor, variacao, status };
  receitaMensal: { valor, variacaoPercent, status };
  margemContribuicao: { valor, status };
  margemLiquida: { valor, projecao2027, status };
  impactoTributarioCaixa: { valor, dataVencimento, status };
  impactoTributarioMargem: { valorPp, percentualReceita, status };
  creditosDisponiveis: { valor, percentualAproveitado, status };
  riscoFiscal: { score, nivel, status };
}
```

- Status: `success` (verde) | `warning` (amarelo) | `danger` (vermelho)
- Insights autom√°ticos baseados em cruzamento de KPIs

---

## Integra√ß√µes ERP

| ERP | M√≥dulos Sincronizados | Status OAuth |
|-----|----------------------|--------------|
| Omie | NF-e, Produtos, Financeiro, Empresa | API Key |
| Bling | NF-e, Produtos | API Key |
| Conta Azul | NF-e, Financeiro | OAuth 2.0 ‚úì |
| Tiny | NF-e, Produtos | API Key |
| Sankhya | NF-e, Financeiro | API Key |
| TOTVS | NF-e, Financeiro | API Key |

### Conta Azul OAuth 2.0

```typescript
// Endpoints oficiais
const CONTAAZUL_ENDPOINTS = {
  authorize: 'https://api.contaazul.com/auth/authorize',
  token: 'https://api.contaazul.com/oauth2/token',
  api: 'https://api.contaazul.com/v1/',
};

// Validade dos tokens
// authorization_code: 3 minutos
// access_token: 1 hora
// refresh_token: 5 anos
```

---

## Webhooks e Pagamentos

### Stripe

```typescript
// stripe-webhook/index.ts
// Eventos tratados:
// - checkout.session.completed ‚Üí ativa plano + envia welcome email
// - customer.subscription.updated ‚Üí atualiza plano
// - customer.subscription.deleted ‚Üí desativa plano

// Welcome Email (Professional):
await sendProfessionalWelcomeEmail(payerEmail);
// Envia via Resend com link Circle
```

---

## Vari√°veis de Ambiente

| Vari√°vel | Uso |
|----------|-----|
| `VITE_SUPABASE_URL` | URL do Supabase |
| `VITE_SUPABASE_PUBLISHABLE_KEY` | Chave p√∫blica |
| `RESEND_API_KEY` | Envio de e-mails |
| `BEEHIIV_API_KEY` | Newsletter |
| `STRIPE_SECRET_KEY` | Pagamentos (via Lovable Stripe connector) |
| `LOVABLE_API_KEY` | IA (Clara AI) |
| `ERP_ENCRYPTION_KEY` | Criptografia de tokens ERP |

---

## RLS (Row Level Security)

Todas as tabelas de usu√°rio t√™m RLS ativo:

```sql
-- Exemplo: profiles
CREATE POLICY "Users can view own profile"
  ON profiles FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can update own profile"
  ON profiles FOR UPDATE
  USING (auth.uid() = user_id);
```

---

## Logs e Monitoramento

| Tabela | Descri√ß√£o |
|--------|-----------|
| `erp_sync_logs` | Logs de sincroniza√ß√£o ERP |
| `executive_report_logs` | Envios de relat√≥rio executivo |
| `stripe_subscription_events` | Eventos do Stripe |
| `credit_usage` | Uso de cr√©ditos Clara AI |
| `clara_conversations` | Hist√≥rico de intera√ß√µes Clara |
| `clara_feedback` | Avalia√ß√µes de qualidade |
| `clara_autonomous_actions` | A√ß√µes executadas automaticamente |

---

## PWA

- Configurado via `vite-plugin-pwa`
- √çcones: `/pwa-192x192.png`, `/pwa-512x512.png`
- Service worker para cache e offline
- Componente `PWAUpdater.tsx` para notificar atualiza√ß√µes

---

## Performance

- **useDashboardData**: Requisi√ß√£o √∫nica batch para dados do dashboard
- **TanStack Query**: Cache e refetch inteligente
- **Lazy loading**: Componentes pesados carregados sob demanda
- **Realtime seletivo**: Apenas tabelas cr√≠ticas (notifications)
- **Clara Cache**: Respostas frequentes cacheadas por categoria
- **Embeddings Cache**: Vetores reutilizados para economia de API

---

## Arquivos de Configura√ß√£o

| Arquivo | Descri√ß√£o |
|---------|-----------|
| `tailwind.config.ts` | Tema customizado + vari√°veis CSS |
| `vite.config.ts` | Build config + PWA |
| `supabase/config.toml` | Configura√ß√£o Supabase |
| `src/config/site.ts` | Links de pagamento + contatos |

---

## Testes

- `vitest` configurado
- Testes de Edge Functions via `supabase--test-edge-functions`
- Arquivos de teste em `src/test/` e `*_test.ts`

---

## Deploy

- **Frontend**: Lovable (auto-deploy no commit)
- **Backend**: Lovable Cloud (Edge Functions auto-deploy)
- **Dom√≠nio Live**: `https://tributechai.lovable.app`
- **Preview**: `https://id-preview--*.lovable.app`

---

## Notas T√©cnicas

### Calculadora NBS (Servi√ßos)

A Calculadora NBS foi criada porque a API oficial (Receita Federal) s√≥ suporta NCM (produtos), n√£o NBS (servi√ßos de 9 d√≠gitos). Usa al√≠quotas estimadas da LC 214/2025:
- Taxa padr√£o: 26.5% (8.8% CBS + 17.7% IBS)
- Setores reduzidos (Sa√∫de, Educa√ß√£o): -40%

### DRE - Precis√£o de C√°lculos

Para evitar duplica√ß√£o:
- Custos de m√£o de obra direta s√£o exclu√≠dos do peso da folha operacional
- Campo "aluguel" n√£o deve ser informado simultaneamente em despesas totais e campo espec√≠fico

### Branding

- Nome oficial: **TribuTalks Intelig√™ncia Tribut√°ria**
- Logotipo obrigat√≥rio em todos os relat√≥rios PDF
- Remo√ß√£o/substitui√ß√£o do logo: apenas plano Enterprise

### Tabela tributbot_messages

A tabela `tributbot_messages` no banco mant√©m nome original por compatibilidade. Armazena hist√≥rico de mensagens da Clara AI.

---

## Documenta√ß√£o Adicional

| Arquivo | Descri√ß√£o |
|---------|-----------|
| `docs/CLARA_AI_PROMPT.md` | Prompt completo da Clara AI |
| `.lovable/plan.md` | Plano de implementa√ß√£o atual |

---

**Fim da Documenta√ß√£o**
