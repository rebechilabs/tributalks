# TribuTalks ‚Äî Documenta√ß√£o Completa para Empres√°rio/Dev

## Resumo Executivo

O TribuTalks √© uma **plataforma SaaS de intelig√™ncia tribut√°ria AI-First** voltada para CEOs e CFOs de empresas com faturamento acima de R$ 1 milh√£o/m√™s. A plataforma ajuda empresas a se prepararem para a **Reforma Tribut√°ria brasileira** (2026-2033), oferecendo simuladores, diagn√≥sticos, IA assistente com mem√≥ria de longo prazo e comunidade.

### Diferenciais AI-First

| Caracter√≠stica | Implementa√ß√£o |
|----------------|---------------|
| **Mem√≥ria de Longo Prazo** | Clara lembra contexto entre sess√µes via `clara_memory` |
| **Feedback Loop** | Coleta thumbs up/down para fine-tuning futuro |
| **Insights Proativos** | Sistema detecta problemas e gera alertas autom√°ticos |
| **Contexto Rico** | Dados reais do usu√°rio (DRE, Score, cr√©ditos) injetados no prompt |
| **Aprendizado Cont√≠nuo** | Cada intera√ß√£o alimenta base de treinamento propriet√°ria |

---

# PARTE 1: VIS√ÉO DO EMPRES√ÅRIO

## Proposta de Valor

| Problema | Solu√ß√£o TribuTalks |
|----------|-------------------|
| Reforma Tribut√°ria complexa (EC 132/2023, LC 214/2025) | Plataforma com timeline, calculadoras e alertas |
| Falta de visibilidade sobre impacto no caixa | NEXUS: 8 KPIs em tempo real |
| Cr√©ditos tribut√°rios n√£o aproveitados | Radar de Cr√©ditos (24 regras automatizadas) |
| Precifica√ß√£o sem considerar novos impostos | PriceGuard com gross-up reverso |
| D√∫vidas tribut√°rias fora do hor√°rio comercial | Clara AI 24/7 com mem√≥ria e contexto |

---

## Planos e Pre√ßos

| Plano | Pre√ßo | CNPJs | Usu√°rios | Destaques |
|-------|-------|-------|----------|-----------|
| **STARTER** | R$ 397/m√™s | 1 | 1 | Clara AI (30 msgs/dia), Score, Split Payment, Calculadora RTC |
| **NAVIGATOR** | R$ 1.297/m√™s | 2 | 2 | + Not√≠cias, Timeline, Workflows, Comunidade Circle |
| **PROFESSIONAL** | R$ 2.997/m√™s | 5 | 4 | + XMLs, Radar Cr√©ditos, DRE, NEXUS, 61+ Oportunidades, ERP |
| **ENTERPRISE** | Sob consulta | ‚àû | ‚àû | + Consultoria jur√≠dica (Rebechi & Silva), White Label, API |

---

## Ferramentas por Categoria

### Etapa 1: ENTENDER
| Ferramenta | Descri√ß√£o | Plano M√≠nimo |
|------------|-----------|--------------|
| Score Tribut√°rio | Avalia sa√∫de fiscal em 11 perguntas (nota A+ a E) | FREE |
| Timeline 2026-2033 | Calend√°rio de marcos da Reforma | FREE |
| Not√≠cias da Reforma | Feed curado + "P√≠lula do Dia" | NAVIGATOR |

### Etapa 2: SIMULAR
| Ferramenta | Descri√ß√£o | Plano M√≠nimo |
|------------|-----------|--------------|
| Simulador Split Payment | Impacto no fluxo de caixa | FREE |
| Comparativo de Regimes | Simples vs Presumido vs Real | FREE |
| Calculadora RTC (NCM) | CBS + IBS + IS por produto | FREE |
| Calculadora NBS (Servi√ßos) | Novos tributos para servi√ßos | NAVIGATOR |

### Etapa 3: DIAGNOSTICAR
| Ferramenta | Descri√ß√£o | Plano M√≠nimo |
|------------|-----------|--------------|
| DRE Inteligente | Demonstrativo + impacto da Reforma no lucro | PROFESSIONAL |
| Radar de Cr√©ditos | 24 regras que identificam cr√©ditos em XMLs | PROFESSIONAL |
| Motor de Oportunidades | 61+ incentivos fiscais mapeados | PROFESSIONAL |
| Suite Margem Ativa | OMC-AI (compras) + PriceGuard (vendas) | PROFESSIONAL |

### Etapa 4: COMANDAR
| Ferramenta | Descri√ß√£o | Plano M√≠nimo |
|------------|-----------|--------------|
| NEXUS | 8 KPIs consolidados + insights autom√°ticos | PROFESSIONAL |
| Painel Executivo | Relat√≥rios PDF + consultoria jur√≠dica | ENTERPRISE |

### EXTRAS
| Ferramenta | Descri√ß√£o | Plano M√≠nimo |
|------------|-----------|--------------|
| Clara AI | Copiloto de decis√£o tribut√°ria com mem√≥ria | STARTER |
| Analisador de Documentos | IA analisa contratos | NAVIGATOR |
| Workflows Guiados | Jornadas estruturadas (4 roteiros) | NAVIGATOR |
| Comunidade Circle | Network + f√≥runs + lives | NAVIGATOR |
| Checklist da Reforma | Avalia prontid√£o operacional | NAVIGATOR |

---

## Sistema de Notifica√ß√µes

| Tipo | Descri√ß√£o |
|------|-----------|
| Sino no Header | Contador de n√£o lidas + lista de notifica√ß√µes |
| Categorias | geral, reforma, indicacao, sistema |
| Realtime | Sincroniza√ß√£o instant√¢nea via WebSocket |
| E-mails | Apenas m√©tricas di√°rias (admin) e contatos diretos |

---

## Clara AI ‚Äî Insights Proativos

O sistema de insights proativos monitora os dados do usu√°rio e gera alertas autom√°ticos:

| Tipo | Exemplos |
|------|----------|
| **Alertas** | Score abaixo de 50, margem cr√≠tica |
| **Recomenda√ß√µes** | Recalcular Score ap√≥s 30 dias, importar mais XMLs |
| **Oportunidades** | Cr√©ditos acima de R$ 10k identificados |
| **Riscos** | Impacto negativo da Reforma na margem |

Os insights aparecem no Dashboard com CTAs diretos para a√ß√£o.

---

## Programa de Indica√ß√£o

| Indica√ß√µes Qualificadas | Desconto |
|-------------------------|----------|
| 1+ | 5% |
| 3+ | 10% |
| 5+ | 15% |
| 10+ | 20% |

- C√≥digo √∫nico no formato `TRIBXXXX`
- Link de indica√ß√£o para `/cadastro?ref=CODIGO`
- Status: pending ‚Üí qualified (30 dias pagos) ‚Üí rewarded

---

## Comunidade e Acessos

| Plano | Acesso |
|-------|--------|
| NAVIGATOR | Grupo de WhatsApp |
| PROFESSIONAL+ | Circle (Intelig√™ncia Tribut√°ria Connect) |

Ao assinar Professional, o usu√°rio recebe automaticamente:
- E-mail de boas-vindas via Resend
- Link pessoal para entrar na comunidade Circle
- Tag `professional_subscriber` no Beehiiv (para automa√ß√µes)

---

## Newsletter (Beehiiv)

- **Tributalks News**: Newsletter semanal com curadoria de not√≠cias
- Tags: `professional_subscriber` para automa√ß√£o de boas-vindas
- Integra√ß√£o via API Beehiiv no webhook de assinatura

---

## Onboarding e Gamifica√ß√£o

### First Mission
- Miss√£o inicial personalizada por regime tribut√°rio
- Simples Nacional, Presumido ou Real t√™m fluxos diferentes

### Guided Tour
- 5 etapas visuais via `react-joyride`
- Apresenta Clara, ferramentas principais e comunidade

### Achievements (14 badges)
- Sistema de conquistas por uso de ferramentas
- Streaks di√°rios de acesso

### Onboarding Checklist
- Aparece nos primeiros 7 dias
- Guia para completar perfil, score, DRE, etc.

---

## Roadmap 2026+

| Feature | Status |
|---------|--------|
| Fine-tuning da Clara com dados coletados | Em coleta |
| Embeddings vetoriais (busca sem√¢ntica) | Planejado |
| App Mobile (iOS/Android) | Planejado |

---

# PARTE 2: VIS√ÉO T√âCNICA (DEV)

## Stack Tecnol√≥gico

| Camada | Tecnologia |
|--------|------------|
| Frontend | React 18 + Vite + TypeScript |
| Estiliza√ß√£o | Tailwind CSS + shadcn/ui |
| Estado | TanStack Query + Context API |
| Backend | Supabase (Lovable Cloud) |
| Edge Functions | Deno (Supabase Functions) |
| AI | Claude Sonnet 4 + Gemini 2.5 Flash via Lovable AI |
| Pagamentos | Stripe (subscriptions + one-off) |
| E-mail | Resend (transacional) + Beehiiv (newsletter) |
| Comunidade | Circle.so |
| PWA | vite-plugin-pwa |

---

## Arquitetura AI-First

### Vis√£o Geral

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        FRONTEND                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Chat UI  ‚îÇ  ‚îÇ Feedback üëçüëé‚îÇ  ‚îÇ Insights Panel (proativo) ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ               ‚îÇ                       ‚îÇ
        ‚ñº               ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     EDGE FUNCTIONS                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ clara-assistant  ‚îÇ  ‚îÇ generate-clara-insights (cron)      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ - Salva conversas‚îÇ  ‚îÇ - Analisa dados                     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ - Extrai mem√≥rias‚îÇ  ‚îÇ - Gera alertas autom√°ticos          ‚îÇ ‚îÇ
‚îÇ  ‚îÇ - Injeta contexto‚îÇ  ‚îÇ - Cria recomenda√ß√µes                ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     DATABASE (Supabase)                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ clara_memory   ‚îÇ  ‚îÇ clara_feedback‚îÇ  ‚îÇ clara_conversations‚îÇ  ‚îÇ
‚îÇ  ‚îÇ (longo prazo)  ‚îÇ  ‚îÇ (fine-tuning) ‚îÇ  ‚îÇ (hist√≥rico)        ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ clara_insights ‚îÇ  ‚îÇ clara_knowledge_base (regras)        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ (proativo)     ‚îÇ  ‚îÇ clara_cache (respostas frequentes)   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Tabelas AI-First

| Tabela | Descri√ß√£o | Uso |
|--------|-----------|-----|
| `clara_memory` | Mem√≥rias de longo prazo por usu√°rio | Contexto entre sess√µes |
| `clara_conversations` | Hist√≥rico de todas as conversas | Continuidade de contexto |
| `clara_feedback` | Avalia√ß√µes üëçüëé das respostas | Base para fine-tuning |
| `clara_insights` | Insights proativos gerados | Alertas autom√°ticos |
| `clara_knowledge_base` | Base de conhecimento jur√≠dico | RAG / Inje√ß√£o de contexto |
| `clara_cache` | Cache de respostas frequentes | Economia de tokens |

### Fluxo de Coleta de Dados (Data Flywheel)

```
Usu√°rio faz pergunta
       ‚Üì
Clara responde (com contexto injetado)
       ‚Üì
Usu√°rio avalia üëç ou üëé
       ‚Üì
Sistema salva:
‚îú‚îÄ‚îÄ clara_conversations (pergunta + resposta)
‚îú‚îÄ‚îÄ clara_feedback (rating + coment√°rio opcional)
‚îî‚îÄ‚îÄ clara_memory (se detectar informa√ß√£o importante)
       ‚Üì
Admin exporta JSONL para fine-tuning
```

### Painel Admin: Training Data Center

Rota: `/admin/training-data`

| Aba | Conte√∫do |
|-----|----------|
| **Vis√£o Geral** | KPIs de coleta, prontid√£o para fine-tuning |
| **Feedback** | Lista de avalia√ß√µes com filtros |
| **Conversas** | Hist√≥rico completo de intera√ß√µes |
| **Mem√≥rias** | Contextos extra√≠dos automaticamente |

Funcionalidades:
- Exportar feedbacks positivos em formato JSONL (OpenAI fine-tuning)
- Exportar feedbacks negativos em CSV para an√°lise
- Indicadores de prontid√£o (metas: 100 positivos, 20 negativos, 50 mem√≥rias)

---

## Estrutura de Arquivos

```text
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/                    # shadcn/ui (50+ componentes)
‚îÇ   ‚îú‚îÄ‚îÄ landing/               # P√°gina de vendas
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/             # Layout + cards do dashboard
‚îÇ   ‚îú‚îÄ‚îÄ clara/                 # Componentes AI-First
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClaraFeedbackButtons.tsx   # Thumbs up/down
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClaraInsightCard.tsx       # Card de insight
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ClaraInsightsPanel.tsx     # Painel de insights
‚îÇ   ‚îú‚îÄ‚îÄ nexus/                 # NEXUS Command Center
‚îÇ   ‚îú‚îÄ‚îÄ credits/               # Radar de Cr√©ditos
‚îÇ   ‚îú‚îÄ‚îÄ dre/                   # DRE Inteligente
‚îÇ   ‚îú‚îÄ‚îÄ onboarding/            # FirstMission, GuidedTour, Checklist
‚îÇ   ‚îú‚îÄ‚îÄ achievements/          # Badges e Streaks
‚îÇ   ‚îú‚îÄ‚îÄ referral/              # Programa de Indica√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ common/                # Componentes compartilhados
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.tsx          # Home logada (com InsightsPanel)
‚îÇ   ‚îú‚îÄ‚îÄ Nexus.tsx              # Centro de Comando
‚îÇ   ‚îú‚îÄ‚îÄ ClaraAI.tsx            # Interface Clara AI (com Feedback)
‚îÇ   ‚îú‚îÄ‚îÄ Indicar.tsx            # Programa de Indica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ calculadora/           # Calculadoras (RTC, NBS, Split)
‚îÇ   ‚îî‚îÄ‚îÄ admin/
‚îÇ       ‚îú‚îÄ‚îÄ AdminDashboard.tsx     # Painel admin principal
‚îÇ       ‚îú‚îÄ‚îÄ AdminTrainingData.tsx  # Training Data Center
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useAuth.tsx            # Autentica√ß√£o + perfil
‚îÇ   ‚îú‚îÄ‚îÄ useClaraMemory.ts      # Mem√≥ria + feedback + insights
‚îÇ   ‚îú‚îÄ‚îÄ useClaraContext.ts     # Contexto de navega√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ useNexusData.ts        # 8 KPIs do NEXUS
‚îÇ   ‚îú‚îÄ‚îÄ useReferral.ts         # Sistema de indica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ useNotifications.ts    # Notifica√ß√µes realtime
‚îÇ   ‚îú‚îÄ‚îÄ useAchievements.ts     # Sistema de badges
‚îÇ   ‚îî‚îÄ‚îÄ useFeatureAccess.ts    # Controle de acesso por plano
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ toolsManual.ts         # Base de conhecimento (18 ferramentas)
‚îÇ   ‚îî‚îÄ‚îÄ checklistReformaItems.ts
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ site.ts                # Links Stripe, contatos
‚îî‚îÄ‚îÄ integrations/
    ‚îî‚îÄ‚îÄ supabase/
        ‚îú‚îÄ‚îÄ client.ts          # Cliente Supabase
        ‚îî‚îÄ‚îÄ types.ts           # Tipos gerados automaticamente
```

---

## Supabase Functions (Edge Functions)

| Fun√ß√£o | Descri√ß√£o |
|--------|-----------|
| `clara-assistant` | Orquestra Clara AI (Claude/Gemini) + salva conversas + extrai mem√≥rias |
| `generate-clara-insights` | Analisa dados e gera insights proativos |
| `stripe-webhook` | Processa assinaturas Stripe + envia e-mail welcome |
| `calculate-rtc` | Calcula CBS/IBS/IS via API Gov |
| `calculate-tax-score` | Gera score tribut√°rio (0-1000) |
| `analyze-credits` | Identifica cr√©ditos em XMLs |
| `process-xml-batch` | Processa lote de XMLs |
| `process-dre` | Calcula DRE + impacto reforma |
| `match-opportunities` | Matching perfil √ó 61 oportunidades |
| `erp-sync` | Sincroniza Omie, Bling, Conta Azul |
| `send-executive-report` | Gera relat√≥rio PDF executivo |
| `fetch-news` | Busca not√≠cias de fontes tribut√°rias |
| `process-referral-rewards` | Aplica descontos de indica√ß√£o |
| `subscribe-newsletter` | Integra Beehiiv |

---

## Tabelas Supabase (Principais)

### Core
| Tabela | Descri√ß√£o |
|--------|-----------|
| `profiles` | Usu√°rios + plano + stripe/mp IDs |
| `company_profile` | Perfil completo da empresa (100+ campos) |
| `company_dre` | DREs + c√°lculos + impacto reforma |
| `tax_score` | Score tribut√°rio + dimens√µes |

### AI-First
| Tabela | Descri√ß√£o |
|--------|-----------|
| `clara_memory` | Mem√≥rias de longo prazo (contexto, decis√µes, prefer√™ncias) |
| `clara_conversations` | Hist√≥rico de conversas (user + assistant) |
| `clara_feedback` | Avalia√ß√µes de respostas (positive, negative, neutral) |
| `clara_insights` | Insights proativos (alertas, recomenda√ß√µes, riscos) |
| `clara_knowledge_base` | Base de conhecimento jur√≠dico/fiscal |
| `clara_cache` | Cache de respostas frequentes |

### Operacional
| Tabela | Descri√ß√£o |
|--------|-----------|
| `identified_credits` | Cr√©ditos encontrados nos XMLs |
| `company_opportunities` | Match usu√°rio √ó oportunidades |
| `notifications` | Sistema de notifica√ß√µes |
| `referral_codes` | C√≥digos de indica√ß√£o |
| `referrals` | Registro de indica√ß√µes |
| `erp_connections` | Conex√µes com ERPs |
| `erp_sync_logs` | Logs de sincroniza√ß√£o |

---

## Clara AI ‚Äî Arquitetura v5 (AI-First)

### Componentes do Sistema

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     CLARA AI SYSTEM                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
‚îÇ  ‚îÇ KNOWLEDGE CORE   ‚îÇ    ‚îÇ DECISION CORE    ‚îÇ                   ‚îÇ
‚îÇ  ‚îÇ (25 heur√≠sticas) ‚îÇ    ‚îÇ (regras de       ‚îÇ                   ‚îÇ
‚îÇ  ‚îÇ                  ‚îÇ    ‚îÇ  interpreta√ß√£o)  ‚îÇ                   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
‚îÇ           ‚îÇ                       ‚îÇ                              ‚îÇ
‚îÇ           ‚ñº                       ‚ñº                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ              CONTEXT INJECTION                      ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ User Data‚îÇ  ‚îÇ Memory   ‚îÇ  ‚îÇ Knowledge Base   ‚îÇ  ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ (DRE,    ‚îÇ  ‚îÇ (longo   ‚îÇ  ‚îÇ (jur√≠dico/       ‚îÇ  ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ Score...)‚îÇ  ‚îÇ  prazo)  ‚îÇ  ‚îÇ  fiscal)         ‚îÇ  ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îÇ                           ‚îÇ                                      ‚îÇ
‚îÇ                           ‚ñº                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ              LLM (Claude Sonnet 4 / Gemini)        ‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îÇ                           ‚îÇ                                      ‚îÇ
‚îÇ                           ‚ñº                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ              POST-PROCESSING                        ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ  - Disclaimer jur√≠dico                             ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ  - Salva conversa                                  ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ  - Extrai mem√≥rias importantes                     ‚îÇ         ‚îÇ
‚îÇ  ‚îÇ  - Cache de respostas frequentes                   ‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Prompt Mestre (3 camadas)

1. **Decision Core** (25 heur√≠sticas)
   - Princ√≠pios de como a Clara interpreta cen√°rios tribut√°rios
   - Ex: "Cr√©dito bem usado vale mais que al√≠quota baixa"

2. **Knowledge Core** (conhecimento factual)
   - EC 132/2023, LC 214/2025
   - Cronograma 2026-2033
   - Al√≠quotas, redu√ß√µes, Simples Nacional, Split Payment

3. **Tool Contexts** (18 ferramentas)
   - Cada ferramenta tem: nome, descri√ß√£o, passo-a-passo
   - Usado para ajuda contextual

### Extra√ß√£o de Mem√≥rias

O sistema detecta padr√µes nas conversas e extrai mem√≥rias automaticamente:

| Padr√£o | Categoria | Import√¢ncia |
|--------|-----------|-------------|
| "minha empresa", "meu neg√≥cio" | empresa | 7 |
| "decidi", "vou fazer", "prefiro" | decisao | 8 |
| "faturamento", "receita", "margem" | financeiro | 6 |
| "simples", "lucro real", "presumido" | regime | 7 |
| "problema", "dificuldade" | suporte | 5 |

### Guardrails

- **Limite OAB**: Nunca emite parecer jur√≠dico
- **Prote√ß√£o anti-jailbreak**: Ignora tentativas de override
- **Linguagem de cen√°rio**: "Este cen√°rio tende a..." em vez de "Voc√™ deve..."

---

## Sistema de Autentica√ß√£o

```typescript
// useAuth.tsx
interface AuthContextType {
  user: User | null;
  session: Session | null;
  profile: Profile | null;
  loading: boolean;
  signUp: (email, password, nome) => Promise<void>;
  signIn: (email, password) => Promise<void>;
  signInWithMagicLink: (email) => Promise<void>;
  signInWithGoogle: () => Promise<void>;
  signOut: () => Promise<void>;
  refreshProfile: () => Promise<void>;
}
```

- Supabase Auth (email/password, magic link, OAuth Google)
- Perfil carregado automaticamente ap√≥s login
- `ProtectedRoute.tsx` garante onboarding completo

---

## Sistema de Notifica√ß√µes

```typescript
// useNotifications.ts
interface Notification {
  id: string;
  title: string;
  message: string;
  type: "info" | "success" | "warning" | "alert";
  category: "geral" | "reforma" | "indicacao" | "sistema";
  read: boolean;
  action_url?: string;
}
```

- Realtime via Supabase Channels
- Persiste na tabela `notifications`
- `NotificationBell.tsx` no header mostra contador

---

## NEXUS ‚Äî 8 KPIs

```typescript
interface NexusKpiData {
  fluxoCaixa: { valor, variacao, status };
  receitaMensal: { valor, variacaoPercent, status };
  margemContribuicao: { valor, status };
  margemLiquida: { valor, projecao2027, status };
  impactoTributarioCaixa: { valor, dataVencimento, status };
  impactoTributarioMargem: { valorPp, percentualReceita, status };
  creditosDisponiveis: { valor, percentualAproveitado, status };
  riscoFiscal: { score, nivel, status };
}
```

- Status: `success` (verde) | `warning` (amarelo) | `danger` (vermelho)
- Insights autom√°ticos baseados em cruzamento de KPIs

---

## Integra√ß√µes ERP

| ERP | M√≥dulos Sincronizados |
|-----|----------------------|
| Omie | NF-e, Produtos, Financeiro, Empresa |
| Bling | NF-e, Produtos |
| Conta Azul | NF-e, Financeiro |
| Tiny | NF-e, Produtos |
| Sankhya | NF-e, Financeiro |
| TOTVS | NF-e, Financeiro |

- Padr√£o Strategy na Edge Function `erp-sync`
- Normaliza dados para schema unificado
- Auto-sync configur√°vel (frequ√™ncia em horas)

---

## Webhooks e Pagamentos

### Stripe

```typescript
// stripe-webhook/index.ts
// Eventos tratados:
// - checkout.session.completed ‚Üí ativa plano + envia welcome email
// - customer.subscription.updated ‚Üí atualiza plano
// - customer.subscription.deleted ‚Üí desativa plano

// Welcome Email (Professional):
await sendProfessionalWelcomeEmail(payerEmail);
// Envia via Resend com link Circle
```

---

## Vari√°veis de Ambiente

| Vari√°vel | Uso |
|----------|-----|
| `VITE_SUPABASE_URL` | URL do Supabase |
| `VITE_SUPABASE_PUBLISHABLE_KEY` | Chave p√∫blica |
| `RESEND_API_KEY` | Envio de e-mails |
| `BEEHIIV_API_KEY` | Newsletter |
| `STRIPE_SECRET_KEY` | Pagamentos (via Lovable Stripe connector) |
| `LOVABLE_API_KEY` | IA (Clara AI) |

---

## RLS (Row Level Security)

Todas as tabelas de usu√°rio t√™m RLS ativo:

```sql
-- Exemplo: profiles
CREATE POLICY "Users can view own profile"
  ON profiles FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can update own profile"
  ON profiles FOR UPDATE
  USING (auth.uid() = user_id);
```

---

## Logs e Monitoramento

| Tabela | Descri√ß√£o |
|--------|-----------|
| `erp_sync_logs` | Logs de sincroniza√ß√£o ERP |
| `executive_report_logs` | Envios de relat√≥rio executivo |
| `stripe_subscription_events` | Eventos do Stripe |
| `credit_usage` | Uso de cr√©ditos Clara AI |
| `clara_conversations` | Hist√≥rico de intera√ß√µes Clara |
| `clara_feedback` | Avalia√ß√µes de qualidade |

---

## PWA

- Configurado via `vite-plugin-pwa`
- √çcones: `/pwa-192x192.png`, `/pwa-512x512.png`
- Service worker para cache e offline
- Componente `PWAUpdater.tsx` para notificar atualiza√ß√µes

---

## Performance

- **useDashboardData**: Requisi√ß√£o √∫nica batch para dados do dashboard
- **TanStack Query**: Cache e refetch inteligente
- **Lazy loading**: Componentes pesados carregados sob demanda
- **Realtime seletivo**: Apenas tabelas cr√≠ticas (notifications)
- **Clara Cache**: Respostas frequentes cacheadas por categoria

---

## Arquivos de Configura√ß√£o

| Arquivo | Descri√ß√£o |
|---------|-----------|
| `tailwind.config.ts` | Tema customizado + vari√°veis CSS |
| `vite.config.ts` | Build config + PWA |
| `supabase/config.toml` | Configura√ß√£o Supabase |
| `src/config/site.ts` | Links de pagamento + contatos |

---

## Testes

- `vitest` configurado
- Testes de Edge Functions via `supabase--test-edge-functions`
- Arquivos de teste em `src/test/` e `*_test.ts`

---

## Deploy

- **Frontend**: Lovable (auto-deploy no commit)
- **Backend**: Lovable Cloud (Edge Functions auto-deploy)
- **Dom√≠nio Live**: `https://tributechai.lovable.app`
- **Preview**: `https://id-preview--*.lovable.app`

---

## Notas T√©cnicas - Refer√™ncias Legadas

### Tabela tributbot_messages
A tabela `tributbot_messages` no banco de dados mant√©m o nome original por raz√µes de compatibilidade. 
Esta tabela armazena o hist√≥rico de mensagens da Clara AI. O nome interno n√£o afeta a experi√™ncia do usu√°rio.

### Feature Key
A feature key `clara_ai` substituiu `tribubot` em:
- `src/hooks/useFeatureAccess.ts`
- `src/hooks/useUserCredits.ts`

Novos registros usam `clara_ai`, mas registros hist√≥ricos podem conter `tribubot`.

### Redirect Legado
A rota `/tribubot` redireciona automaticamente para `/clara-ai` para manter compatibilidade com links antigos.

---

## Estrat√©gia AI-First: Pr√≥ximos Passos

### Fase 1: Coleta de Dados (ATUAL)
- [x] Tabelas de mem√≥ria, feedback e conversas
- [x] Bot√µes de thumbs up/down no chat
- [x] Extra√ß√£o autom√°tica de mem√≥rias
- [x] Painel admin Training Data Center
- [x] Export JSONL para fine-tuning

### Fase 2: RAG Sem√¢ntico
- [ ] Habilitar pgvector para embeddings
- [ ] Embeddings da knowledge_base
- [ ] Busca sem√¢ntica em mem√≥rias
- [ ] Threshold de similaridade configur√°vel

### Fase 3: Fine-Tuning
- [ ] Atingir 100+ feedbacks positivos
- [ ] Curar dataset (remover ru√≠do)
- [ ] Fine-tune modelo especializado
- [ ] A/B test vs modelo base

### Fase 4: Agentes Aut√¥nomos
- [ ] Clara executa a√ß√µes (n√£o s√≥ responde)
- [ ] Workflows end-to-end automatizados
- [ ] UI "invis√≠vel" (auditoria apenas)
- [ ] MCP para integra√ß√£o cross-tool
