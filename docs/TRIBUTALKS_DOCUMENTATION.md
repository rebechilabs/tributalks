# TribuTalks â€” DocumentaÃ§Ã£o Completa para EmpresÃ¡rio/Dev

## Resumo Executivo

O TribuTalks Ã© uma **plataforma SaaS de inteligÃªncia tributÃ¡ria AI-Native** voltada para CEOs e CFOs de empresas com faturamento acima de R$ 1 milhÃ£o/mÃªs. A plataforma ajuda empresas a se prepararem para a **Reforma TributÃ¡ria brasileira** (2026-2033), oferecendo simuladores, diagnÃ³sticos, IA assistente com memÃ³ria evolutiva, agentes especializados e comunidade.

### Diferenciais AI-Native

| CaracterÃ­stica | ImplementaÃ§Ã£o |
|----------------|---------------|
| **Agentes Especializados** | 3 agentes (Fiscal, Margem, Compliance) com routing inteligente |
| **MemÃ³ria Evolutiva** | Clara aprende padrÃµes e preferÃªncias de cada usuÃ¡rio |
| **AÃ§Ãµes AutÃ´nomas** | Sistema de triggers que executa tarefas automaticamente |
| **Feedback Loop** | Coleta thumbs up/down para fine-tuning futuro |
| **Insights Proativos** | Sistema detecta problemas e gera alertas automÃ¡ticos |
| **Contexto Rico** | Dados reais do usuÃ¡rio (DRE, Score, crÃ©ditos) injetados no prompt |
| **Aprendizado ContÃ­nuo** | Cada interaÃ§Ã£o alimenta base de treinamento proprietÃ¡ria |

---

# PARTE 1: VISÃƒO DO EMPRESÃRIO

## Proposta de Valor

| Problema | SoluÃ§Ã£o TribuTalks |
|----------|-------------------|
| Reforma TributÃ¡ria complexa (EC 132/2023, LC 214/2025) | Plataforma com timeline, calculadoras e alertas |
| Falta de visibilidade sobre impacto no caixa | NEXUS: 8 KPIs em tempo real |
| CrÃ©ditos tributÃ¡rios nÃ£o aproveitados | Radar de CrÃ©ditos (24 regras automatizadas) |
| PrecificaÃ§Ã£o sem considerar novos impostos | PriceGuard com gross-up reverso |
| DÃºvidas tributÃ¡rias fora do horÃ¡rio comercial | Clara AI 24/7 com agentes especializados |

---

## Planos e PreÃ§os

| Plano | PreÃ§o | CNPJs | UsuÃ¡rios | Destaques |
|-------|-------|-------|----------|-----------|
| **STARTER** | R$ 397/mÃªs | 1 | 1 | Clara AI (30 msgs/dia), Score, Split Payment, Calculadora RTC |
| **NAVIGATOR** | R$ 1.297/mÃªs | 2 | 2 | + NotÃ­cias, Timeline, Workflows, Comunidade Circle |
| **PROFESSIONAL** | R$ 2.997/mÃªs | 5 | 4 | + XMLs, Radar CrÃ©ditos, DRE, NEXUS, 61+ Oportunidades, ERP |
| **ENTERPRISE** | Sob consulta | âˆ | âˆ | + Consultoria jurÃ­dica (Rebechi & Silva), White Label, API |

---

## Ferramentas por Categoria

### Etapa 1: ENTENDER
| Ferramenta | DescriÃ§Ã£o | Plano MÃ­nimo |
|------------|-----------|--------------|
| Score TributÃ¡rio | Avalia saÃºde fiscal em 11 perguntas (nota A+ a E) | FREE |
| Timeline 2026-2033 | CalendÃ¡rio de marcos da Reforma | FREE |
| NotÃ­cias da Reforma | Feed curado + "PÃ­lula do Dia" | NAVIGATOR |

### Etapa 2: SIMULAR
| Ferramenta | DescriÃ§Ã£o | Plano MÃ­nimo |
|------------|-----------|--------------|
| Simulador Split Payment | Impacto no fluxo de caixa | FREE |
| Comparativo de Regimes | Simples vs Presumido vs Real | FREE |
| Calculadora RTC (NCM) | CBS + IBS + IS por produto | FREE |
| Calculadora NBS (ServiÃ§os) | Novos tributos para serviÃ§os | NAVIGATOR |

### Etapa 3: DIAGNOSTICAR
| Ferramenta | DescriÃ§Ã£o | Plano MÃ­nimo |
|------------|-----------|--------------|
| DRE Inteligente | Demonstrativo + impacto da Reforma no lucro | PROFESSIONAL |
| Radar de CrÃ©ditos | 24 regras que identificam crÃ©ditos em XMLs | PROFESSIONAL |
| Motor de Oportunidades | 61+ incentivos fiscais mapeados | PROFESSIONAL |
| Suite Margem Ativa | OMC-AI (compras) + PriceGuard (vendas) | PROFESSIONAL |

### Etapa 4: COMANDAR
| Ferramenta | DescriÃ§Ã£o | Plano MÃ­nimo |
|------------|-----------|--------------|
| NEXUS | 8 KPIs consolidados + insights automÃ¡ticos | PROFESSIONAL |
| Painel Executivo | RelatÃ³rios PDF + consultoria jurÃ­dica | ENTERPRISE |

### EXTRAS
| Ferramenta | DescriÃ§Ã£o | Plano MÃ­nimo |
|------------|-----------|--------------|
| Clara AI | Copiloto tributÃ¡rio com agentes especializados | STARTER |
| Analisador de Documentos | IA analisa contratos | NAVIGATOR |
| Workflows Guiados | Jornadas estruturadas (4 roteiros) | NAVIGATOR |
| Comunidade Circle | Network + fÃ³runs + lives | NAVIGATOR |
| Checklist da Reforma | Avalia prontidÃ£o operacional | NAVIGATOR |

---

## Sistema de NotificaÃ§Ãµes

| Tipo | DescriÃ§Ã£o |
|------|-----------|
| Sino no Header | Contador de nÃ£o lidas + lista de notificaÃ§Ãµes |
| Categorias | geral, reforma, indicacao, sistema |
| Realtime | SincronizaÃ§Ã£o instantÃ¢nea via WebSocket |
| E-mails | Apenas mÃ©tricas diÃ¡rias (admin) e contatos diretos |

---

## Clara AI â€” Sistema de Agentes Especializados

A Clara utiliza uma arquitetura AI-Native com 3 agentes especializados que colaboram:

### Agentes

| Agente | DomÃ­nio | Capabilities |
|--------|---------|--------------|
| **Fiscal** | CrÃ©ditos, NCM, obrigaÃ§Ãµes | AnÃ¡lise de crÃ©ditos, classificaÃ§Ã£o NCM, compliance fiscal |
| **Margem** | DRE, pricing, custos | ProteÃ§Ã£o de margem, simulaÃ§Ã£o de preÃ§os, anÃ¡lise de custos |
| **Compliance** | Prazos, reforma, regulatÃ³rio | Monitoramento de deadlines, alertas de mudanÃ§as, adequaÃ§Ã£o |

### Routing Inteligente

O sistema usa keyword scoring + anÃ¡lise de contexto de tela para rotear automaticamente:

```
UsuÃ¡rio: "Qual o impacto do CBS na minha margem?"
           â†“
Router: Detecta "CBS" (fiscal) + "margem" (margin)
           â†“
Agente Selecionado: MarginAgent (margem tem prioridade pelo contexto)
```

### Insights Proativos

| Tipo | Exemplos |
|------|----------|
| **Alertas** | Score abaixo de 50, margem crÃ­tica |
| **RecomendaÃ§Ãµes** | Recalcular Score apÃ³s 30 dias, importar mais XMLs |
| **Oportunidades** | CrÃ©ditos acima de R$ 10k identificados |
| **Riscos** | Impacto negativo da Reforma na margem |

Os insights aparecem no Dashboard com CTAs diretos para aÃ§Ã£o.

---

## Programa de IndicaÃ§Ã£o

| IndicaÃ§Ãµes Qualificadas | Desconto |
|-------------------------|----------|
| 1+ | 5% |
| 3+ | 10% |
| 5+ | 15% |
| 10+ | 20% |

- CÃ³digo Ãºnico no formato `TRIBXXXX`
- Link de indicaÃ§Ã£o para `/cadastro?ref=CODIGO`
- Status: pending â†’ qualified (30 dias pagos) â†’ rewarded

---

## Comunidade e Acessos

| Plano | Acesso |
|-------|--------|
| NAVIGATOR | Grupo de WhatsApp |
| PROFESSIONAL+ | Circle (InteligÃªncia TributÃ¡ria Connect) |

Ao assinar Professional, o usuÃ¡rio recebe automaticamente:
- E-mail de boas-vindas via Resend
- Link pessoal para entrar na comunidade Circle
- Tag `professional_subscriber` no Beehiiv (para automaÃ§Ãµes)

---

## Newsletter (Beehiiv)

- **Tributalks News**: Newsletter semanal com curadoria de notÃ­cias
- Tags: `professional_subscriber` para automaÃ§Ã£o de boas-vindas
- IntegraÃ§Ã£o via API Beehiiv no webhook de assinatura

---

## Onboarding e GamificaÃ§Ã£o

### First Mission
- MissÃ£o inicial personalizada por regime tributÃ¡rio
- Simples Nacional, Presumido ou Real tÃªm fluxos diferentes

### Guided Tour
- 5 etapas visuais via `react-joyride`
- Apresenta Clara, ferramentas principais e comunidade

### Achievements (14 badges)
- Sistema de conquistas por uso de ferramentas
- Streaks diÃ¡rios de acesso

### Onboarding Checklist
- Aparece nos primeiros 7 dias
- Guia para completar perfil, score, DRE, etc.

---

## Roadmap 2026+

| Feature | Status |
|---------|--------|
| Agentes Especializados (Fiscal, Margem, Compliance) | âœ… Implementado |
| MemÃ³ria Evolutiva | âœ… Implementado |
| AÃ§Ãµes AutÃ´nomas | âœ… Implementado |
| Fine-tuning da Clara com dados coletados | Em coleta |
| Embeddings vetoriais (busca semÃ¢ntica) | Planejado |
| App Mobile (iOS/Android) | Planejado |
| OrquestraÃ§Ã£o MCP | Planejado |

---

# PARTE 2: VISÃƒO TÃ‰CNICA (DEV)

## Stack TecnolÃ³gico

| Camada | Tecnologia |
|--------|------------|
| Frontend | React 18 + Vite + TypeScript |
| EstilizaÃ§Ã£o | Tailwind CSS + shadcn/ui |
| Estado | TanStack Query + Context API |
| Backend | Supabase (Lovable Cloud) |
| Edge Functions | Deno (Supabase Functions) |
| AI | Claude Sonnet 4 + Gemini 2.5 Flash via Lovable AI |
| Pagamentos | Stripe (subscriptions + one-off) |
| E-mail | Resend (transacional) + Beehiiv (newsletter) |
| Comunidade | Circle.so |
| PWA | vite-plugin-pwa |

---

## Arquitetura AI-Native (v6)

### Diagrama Geral

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CLARA AI SYSTEM                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    ORQUESTRADOR CENTRAL                            â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â”‚
â”‚  â”‚     â”‚ FISCAL AGENT â”‚ â”‚ MARGIN AGENT â”‚ â”‚ COMPLIANCE   â”‚            â”‚ â”‚
â”‚  â”‚     â”‚              â”‚ â”‚              â”‚ â”‚ AGENT        â”‚            â”‚ â”‚
â”‚  â”‚     â”‚ â€¢ CrÃ©ditos   â”‚ â”‚ â€¢ DRE        â”‚ â”‚ â€¢ Prazos     â”‚            â”‚ â”‚
â”‚  â”‚     â”‚ â€¢ NCM        â”‚ â”‚ â€¢ Pricing    â”‚ â”‚ â€¢ Reforma    â”‚            â”‚ â”‚
â”‚  â”‚     â”‚ â€¢ Compliance â”‚ â”‚ â€¢ Custos     â”‚ â”‚ â€¢ AdequaÃ§Ã£o  â”‚            â”‚ â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚
â”‚  â”‚            â”‚                â”‚                â”‚                     â”‚ â”‚
â”‚  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚ â”‚
â”‚  â”‚                             â”‚                                      â”‚ â”‚
â”‚  â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                              â”‚ â”‚
â”‚  â”‚                     â”‚    ROUTER     â”‚                              â”‚ â”‚
â”‚  â”‚                     â”‚ (keyword +    â”‚                              â”‚ â”‚
â”‚  â”‚                     â”‚  context)     â”‚                              â”‚ â”‚
â”‚  â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     MEMÃ“RIA EVOLUTIVA                              â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ PreferÃªncias â”‚  â”‚   PadrÃµes    â”‚  â”‚ DecisÃµes do UsuÃ¡rio      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ (confidence) â”‚  â”‚  Detectados  â”‚  â”‚ (histÃ³rico)              â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  Confidence Score: 0.1 â†’ 0.95 (aumenta com reforÃ§o)               â”‚ â”‚
â”‚  â”‚  Decay Rate: PadrÃµes antigos perdem relevÃ¢ncia                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     AÃ‡Ã•ES AUTÃ”NOMAS                                â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  Triggers:                                                          â”‚ â”‚
â”‚  â”‚  â€¢ xml_imported â†’ analyze_credits (auto)                           â”‚ â”‚
â”‚  â”‚  â€¢ score_below_60 â†’ compliance_alert (auto)                        â”‚ â”‚
â”‚  â”‚  â€¢ margin_drop_5pp â†’ margin_alert (auto)                           â”‚ â”‚
â”‚  â”‚  â€¢ deadline_7_days â†’ send_reminder (auto)                          â”‚ â”‚
â”‚  â”‚  â€¢ benefit_expiring â†’ alert_expiration (auto)                      â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  Status: pending â†’ approved â†’ executed                              â”‚ â”‚
â”‚  â”‚  Priority: low | medium | high | urgent                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tabelas AI-Native

| Tabela | DescriÃ§Ã£o | Uso |
|--------|-----------|-----|
| `clara_agents` | ConfiguraÃ§Ã£o dos agentes especializados | Capabilities, triggers, prioridades |
| `clara_autonomous_actions` | Fila de aÃ§Ãµes autÃ´nomas | Triggers, payloads, status, resultados |
| `clara_user_decisions` | DecisÃµes do usuÃ¡rio rastreadas | Contexto, opÃ§Ãµes, escolha, feedback |
| `clara_learned_patterns` | PadrÃµes aprendidos por usuÃ¡rio | Tipo, valor, confidence, decay |
| `clara_memory` | MemÃ³rias de longo prazo | Contexto, importÃ¢ncia, reforÃ§os |
| `clara_conversations` | HistÃ³rico de todas as conversas | Continuidade de contexto |
| `clara_feedback` | AvaliaÃ§Ãµes ğŸ‘ğŸ‘ das respostas | Base para fine-tuning |
| `clara_insights` | Insights proativos gerados | Alertas automÃ¡ticos |
| `clara_knowledge_base` | Base de conhecimento jurÃ­dico | RAG / InjeÃ§Ã£o de contexto |
| `clara_cache` | Cache de respostas frequentes | Economia de tokens |

### Hooks AI-Native

```typescript
// src/hooks/clara/index.ts

// Agentes Especializados
export { useClaraAgents, useFiscalAgent, useMarginAgent, useComplianceAgent } from './useClaraAgents';

// MemÃ³ria Evolutiva e Aprendizado
export { useClaraLearning, useClaraContextMemory } from './useClaraLearning';

// AÃ§Ãµes AutÃ´nomas
export { useClaraAutonomousActions, AUTO_TRIGGERS } from './useClaraAutonomousActions';
```

### Componentes AI-Native

```typescript
// src/components/clara/index.ts

export { ClaraAgentBadge } from './ClaraAgentBadge';           // Badge do agente ativo
export { ClaraAutonomousActionCard } from './ClaraAutonomousActionCard';  // Card de aÃ§Ã£o
export { ClaraAutonomousPanel } from './ClaraAutonomousPanel';  // Painel de aÃ§Ãµes pendentes
export { ClaraFeedbackButtons } from './ClaraFeedbackButtons';  // Thumbs up/down
export { ClaraInsightCard } from './ClaraInsightCard';          // Card de insight
export { ClaraInsightsPanel } from './ClaraInsightsPanel';      // Painel de insights
```

### Sistema de Agentes

```typescript
// Tipos de Agentes
type AgentType = 'fiscal' | 'margin' | 'compliance' | 'general';

// Interface do Agente
interface ClaraAgent {
  id: string;
  name: string;
  description: string;
  type: AgentType;
  capabilities: string[];
  triggerConditions: Record<string, unknown>;
  priorityRules: Record<string, unknown>;
  status: 'active' | 'inactive' | 'learning';
}

// Routing
const routeQuery = (query: string, screenContext?: string): AgentType => {
  // 1. Conta keywords de cada domÃ­nio
  // 2. Considera contexto de tela
  // 3. Retorna agente com maior score
};
```

### Sistema de MemÃ³ria Evolutiva

```typescript
// PadrÃ£o Aprendido
interface LearnedPattern {
  id: string;
  userId: string;
  patternType: 'preference' | 'behavior' | 'decision' | 'context';
  patternKey: string;
  patternValue: Record<string, unknown>;
  confidence: number;        // 0.1 a 0.95
  timesObserved: number;
  decayRate: number;         // Quanto perde por dia sem uso
  lastObservedAt: Date;
}

// Ajuste de Confidence
const adjustConfidence = (current: number, positive: boolean): number => {
  const delta = positive ? 0.1 : -0.15;
  return Math.max(0.1, Math.min(0.95, current + delta));
};
```

### Sistema de AÃ§Ãµes AutÃ´nomas

```typescript
// Triggers DisponÃ­veis
const AUTO_TRIGGERS = {
  'xml_imported': {
    event: 'xml_imported',
    agentType: 'fiscal',
    actionType: 'analyze_credits',
    requiresApproval: false,
    priority: 'medium',
  },
  'score_below_60': {
    event: 'score_below_threshold',
    agentType: 'fiscal',
    actionType: 'generate_compliance_alert',
    requiresApproval: false,
    priority: 'high',
  },
  'margin_drop_5pp': {
    event: 'margin_drop_detected',
    agentType: 'margin',
    actionType: 'generate_margin_alert',
    requiresApproval: false,
    priority: 'high',
  },
  // ... mais triggers
};

// Status Flow
// pending â†’ approved â†’ executed
// pending â†’ rejected
// approved â†’ failed
```

### Fluxo de Dados (Data Flywheel)

```
UsuÃ¡rio interage com plataforma
        â†“
Sistema detecta eventos (XML importado, DRE atualizado, etc.)
        â†“
AUTO_TRIGGERS disparam aÃ§Ãµes autÃ´nomas
        â†“
Agente especializado processa a tarefa
        â†“
Sistema aprende com resultado:
â”œâ”€â”€ clara_learned_patterns (padrÃµes detectados)
â”œâ”€â”€ clara_user_decisions (escolhas do usuÃ¡rio)
â””â”€â”€ clara_memory (contexto importante)
        â†“
Clara se torna mais inteligente e personalizada
```

---

## Estrutura de Arquivos

```text
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                    # shadcn/ui (50+ componentes)
â”‚   â”œâ”€â”€ landing/               # PÃ¡gina de vendas
â”‚   â”œâ”€â”€ dashboard/             # Layout + cards do dashboard
â”‚   â”œâ”€â”€ clara/                 # Componentes AI-Native
â”‚   â”‚   â”œâ”€â”€ ClaraAgentBadge.tsx        # Badge do agente ativo
â”‚   â”‚   â”œâ”€â”€ ClaraAutonomousActionCard.tsx  # Card de aÃ§Ã£o autÃ´noma
â”‚   â”‚   â”œâ”€â”€ ClaraAutonomousPanel.tsx   # Painel de aÃ§Ãµes pendentes
â”‚   â”‚   â”œâ”€â”€ ClaraFeedbackButtons.tsx   # Thumbs up/down
â”‚   â”‚   â”œâ”€â”€ ClaraInsightCard.tsx       # Card de insight
â”‚   â”‚   â””â”€â”€ ClaraInsightsPanel.tsx     # Painel de insights
â”‚   â”œâ”€â”€ nexus/                 # NEXUS Command Center
â”‚   â”œâ”€â”€ credits/               # Radar de CrÃ©ditos
â”‚   â”œâ”€â”€ dre/                   # DRE Inteligente
â”‚   â”œâ”€â”€ onboarding/            # FirstMission, GuidedTour, Checklist
â”‚   â”œâ”€â”€ achievements/          # Badges e Streaks
â”‚   â”œâ”€â”€ referral/              # Programa de IndicaÃ§Ã£o
â”‚   â””â”€â”€ common/                # Componentes compartilhados
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ Dashboard.tsx          # Home logada (com InsightsPanel)
â”‚   â”œâ”€â”€ Nexus.tsx              # Centro de Comando
â”‚   â”œâ”€â”€ ClaraAI.tsx            # Interface Clara AI (com Feedback)
â”‚   â”œâ”€â”€ Indicar.tsx            # Programa de IndicaÃ§Ã£o
â”‚   â”œâ”€â”€ calculadora/           # Calculadoras (RTC, NBS, Split)
â”‚   â””â”€â”€ admin/
â”‚       â”œâ”€â”€ AdminDashboard.tsx     # Painel admin principal
â”‚       â”œâ”€â”€ AdminTrainingData.tsx  # Training Data Center
â”‚       â””â”€â”€ ...
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useAuth.tsx            # AutenticaÃ§Ã£o + perfil
â”‚   â”œâ”€â”€ clara/                 # Hooks AI-Native
â”‚   â”‚   â”œâ”€â”€ index.ts           # Exports centralizados
â”‚   â”‚   â”œâ”€â”€ useClaraAgents.ts  # Agentes especializados + routing
â”‚   â”‚   â”œâ”€â”€ useClaraLearning.ts    # MemÃ³ria evolutiva + padrÃµes
â”‚   â”‚   â””â”€â”€ useClaraAutonomousActions.ts  # AÃ§Ãµes autÃ´nomas
â”‚   â”œâ”€â”€ useClaraMemory.ts      # MemÃ³ria + feedback + insights
â”‚   â”œâ”€â”€ useClaraContext.ts     # Contexto de navegaÃ§Ã£o
â”‚   â”œâ”€â”€ useNexusData.ts        # 8 KPIs do NEXUS
â”‚   â”œâ”€â”€ useReferral.ts         # Sistema de indicaÃ§Ã£o
â”‚   â”œâ”€â”€ useNotifications.ts    # NotificaÃ§Ãµes realtime
â”‚   â”œâ”€â”€ useAchievements.ts     # Sistema de badges
â”‚   â””â”€â”€ useFeatureAccess.ts    # Controle de acesso por plano
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ toolsManual.ts         # Base de conhecimento (18 ferramentas)
â”‚   â””â”€â”€ checklistReformaItems.ts
â”œâ”€â”€ config/
â”‚   â””â”€â”€ site.ts                # Links Stripe, contatos
â””â”€â”€ integrations/
    â””â”€â”€ supabase/
        â”œâ”€â”€ client.ts          # Cliente Supabase
        â””â”€â”€ types.ts           # Tipos gerados automaticamente
```

---

## Supabase Functions (Edge Functions)

| FunÃ§Ã£o | DescriÃ§Ã£o |
|--------|-----------|
| `clara-assistant` | Orquestra Clara AI (Claude/Gemini) + salva conversas + extrai memÃ³rias |
| `generate-clara-insights` | Analisa dados e gera insights proativos |
| `stripe-webhook` | Processa assinaturas Stripe + envia e-mail welcome |
| `calculate-rtc` | Calcula CBS/IBS/IS via API Gov |
| `calculate-tax-score` | Gera score tributÃ¡rio (0-1000) |
| `analyze-credits` | Identifica crÃ©ditos em XMLs |
| `process-xml-batch` | Processa lote de XMLs |
| `process-dre` | Calcula DRE + impacto reforma |
| `match-opportunities` | Matching perfil Ã— 61 oportunidades |
| `erp-sync` | Sincroniza Omie, Bling, Conta Azul |
| `send-executive-report` | Gera relatÃ³rio PDF executivo |
| `fetch-news` | Busca notÃ­cias de fontes tributÃ¡rias |
| `process-referral-rewards` | Aplica descontos de indicaÃ§Ã£o |
| `subscribe-newsletter` | Integra Beehiiv |

---

## Tabelas Supabase (Principais)

### Core
| Tabela | DescriÃ§Ã£o |
|--------|-----------|
| `profiles` | UsuÃ¡rios + plano + stripe/mp IDs |
| `company_profile` | Perfil completo da empresa (100+ campos) |
| `company_dre` | DREs + cÃ¡lculos + impacto reforma |
| `tax_score` | Score tributÃ¡rio + dimensÃµes |

### AI-Native
| Tabela | DescriÃ§Ã£o |
|--------|-----------|
| `clara_agents` | ConfiguraÃ§Ã£o dos agentes especializados |
| `clara_autonomous_actions` | Fila de aÃ§Ãµes autÃ´nomas com triggers |
| `clara_user_decisions` | DecisÃµes rastreadas para aprendizado |
| `clara_learned_patterns` | PadrÃµes aprendidos (preferÃªncias, comportamentos) |
| `clara_memory` | MemÃ³rias de longo prazo (contexto, decisÃµes, preferÃªncias) |
| `clara_conversations` | HistÃ³rico de conversas (user + assistant) |
| `clara_feedback` | AvaliaÃ§Ãµes de respostas (positive, negative, neutral) |
| `clara_insights` | Insights proativos (alertas, recomendaÃ§Ãµes, riscos) |
| `clara_knowledge_base` | Base de conhecimento jurÃ­dico/fiscal |
| `clara_cache` | Cache de respostas frequentes |

### Operacional
| Tabela | DescriÃ§Ã£o |
|--------|-----------|
| `identified_credits` | CrÃ©ditos encontrados nos XMLs |
| `company_opportunities` | Match usuÃ¡rio Ã— oportunidades |
| `notifications` | Sistema de notificaÃ§Ãµes |
| `referral_codes` | CÃ³digos de indicaÃ§Ã£o |
| `referrals` | Registro de indicaÃ§Ãµes |
| `erp_connections` | ConexÃµes com ERPs |
| `erp_sync_logs` | Logs de sincronizaÃ§Ã£o |

---

## Clara AI â€” Prompt Architecture

### Componentes do Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLARA AI SYSTEM                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ KNOWLEDGE CORE   â”‚    â”‚ DECISION CORE    â”‚                   â”‚
â”‚  â”‚ (25 heurÃ­sticas) â”‚    â”‚ (regras de       â”‚                   â”‚
â”‚  â”‚                  â”‚    â”‚  interpretaÃ§Ã£o)  â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚           â”‚                       â”‚                              â”‚
â”‚           â–¼                       â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚              CONTEXT INJECTION                      â”‚         â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚
â”‚  â”‚  â”‚ User Dataâ”‚  â”‚ Memory   â”‚  â”‚ Learned Patterns â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ (DRE,    â”‚  â”‚ (longo   â”‚  â”‚ (preferÃªncias)   â”‚  â”‚         â”‚
â”‚  â”‚  â”‚ Score...)â”‚  â”‚  prazo)  â”‚  â”‚                  â”‚  â”‚         â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚              AGENT ROUTER                           â”‚         â”‚
â”‚  â”‚  Fiscal | Margin | Compliance | General            â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚              LLM (Claude Sonnet 4 / Gemini)        â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚              POST-PROCESSING                        â”‚         â”‚
â”‚  â”‚  - Disclaimer jurÃ­dico                             â”‚         â”‚
â”‚  â”‚  - Salva conversa                                  â”‚         â”‚
â”‚  â”‚  - Extrai memÃ³rias importantes                     â”‚         â”‚
â”‚  â”‚  - Aprende padrÃµes                                 â”‚         â”‚
â”‚  â”‚  - Cache de respostas frequentes                   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Prompt Mestre (3 camadas)

1. **Decision Core** (25 heurÃ­sticas)
   - PrincÃ­pios de como a Clara interpreta cenÃ¡rios tributÃ¡rios
   - Ex: "CrÃ©dito bem usado vale mais que alÃ­quota baixa"

2. **Knowledge Core** (conhecimento factual)
   - EC 132/2023, LC 214/2025
   - Cronograma 2026-2033
   - AlÃ­quotas, reduÃ§Ãµes, Simples Nacional, Split Payment

3. **Tool Contexts** (18 ferramentas)
   - Cada ferramenta tem: nome, descriÃ§Ã£o, passo-a-passo
   - Usado para ajuda contextual

### ExtraÃ§Ã£o de MemÃ³rias

O sistema detecta padrÃµes nas conversas e extrai memÃ³rias automaticamente:

| PadrÃ£o | Categoria | ImportÃ¢ncia |
|--------|-----------|-------------|
| "minha empresa", "meu negÃ³cio" | empresa | 7 |
| "decidi", "vou fazer", "prefiro" | decisao | 8 |
| "faturamento", "receita", "margem" | financeiro | 6 |
| "simples", "lucro real", "presumido" | regime | 7 |
| "problema", "dificuldade" | suporte | 5 |

### Guardrails

- **Limite OAB**: Nunca emite parecer jurÃ­dico
- **ProteÃ§Ã£o anti-jailbreak**: Ignora tentativas de override
- **Linguagem de cenÃ¡rio**: "Este cenÃ¡rio tende a..." em vez de "VocÃª deve..."

---

## Sistema de AutenticaÃ§Ã£o

```typescript
// useAuth.tsx
interface AuthContextType {
  user: User | null;
  session: Session | null;
  profile: Profile | null;
  loading: boolean;
  signUp: (email, password, nome) => Promise<void>;
  signIn: (email, password) => Promise<void>;
  signInWithMagicLink: (email) => Promise<void>;
  signInWithGoogle: () => Promise<void>;
  signOut: () => Promise<void>;
  refreshProfile: () => Promise<void>;
}
```

- Supabase Auth (email/password, magic link, OAuth Google)
- Perfil carregado automaticamente apÃ³s login
- `ProtectedRoute.tsx` garante onboarding completo

---

## Sistema de NotificaÃ§Ãµes

```typescript
// useNotifications.ts
interface Notification {
  id: string;
  title: string;
  message: string;
  type: "info" | "success" | "warning" | "alert";
  category: "geral" | "reforma" | "indicacao" | "sistema";
  read: boolean;
  action_url?: string;
}
```

- Realtime via Supabase Channels
- Persiste na tabela `notifications`
- `NotificationBell.tsx` no header mostra contador

---

## NEXUS â€” 8 KPIs

```typescript
interface NexusKpiData {
  fluxoCaixa: { valor, variacao, status };
  receitaMensal: { valor, variacaoPercent, status };
  margemContribuicao: { valor, status };
  margemLiquida: { valor, projecao2027, status };
  impactoTributarioCaixa: { valor, dataVencimento, status };
  impactoTributarioMargem: { valorPp, percentualReceita, status };
  creditosDisponiveis: { valor, percentualAproveitado, status };
  riscoFiscal: { score, nivel, status };
}
```

- Status: `success` (verde) | `warning` (amarelo) | `danger` (vermelho)
- Insights automÃ¡ticos baseados em cruzamento de KPIs

---

## IntegraÃ§Ãµes ERP

| ERP | MÃ³dulos Sincronizados |
|-----|----------------------|
| Omie | NF-e, Produtos, Financeiro, Empresa |
| Bling | NF-e, Produtos |
| Conta Azul | NF-e, Financeiro |
| Tiny | NF-e, Produtos |
| Sankhya | NF-e, Financeiro |
| TOTVS | NF-e, Financeiro |

- PadrÃ£o Strategy na Edge Function `erp-sync`
- Normaliza dados para schema unificado
- Auto-sync configurÃ¡vel (frequÃªncia em horas)

---

## Webhooks e Pagamentos

### Stripe

```typescript
// stripe-webhook/index.ts
// Eventos tratados:
// - checkout.session.completed â†’ ativa plano + envia welcome email
// - customer.subscription.updated â†’ atualiza plano
// - customer.subscription.deleted â†’ desativa plano

// Welcome Email (Professional):
await sendProfessionalWelcomeEmail(payerEmail);
// Envia via Resend com link Circle
```

---

## VariÃ¡veis de Ambiente

| VariÃ¡vel | Uso |
|----------|-----|
| `VITE_SUPABASE_URL` | URL do Supabase |
| `VITE_SUPABASE_PUBLISHABLE_KEY` | Chave pÃºblica |
| `RESEND_API_KEY` | Envio de e-mails |
| `BEEHIIV_API_KEY` | Newsletter |
| `STRIPE_SECRET_KEY` | Pagamentos (via Lovable Stripe connector) |
| `LOVABLE_API_KEY` | IA (Clara AI) |

---

## RLS (Row Level Security)

Todas as tabelas de usuÃ¡rio tÃªm RLS ativo:

```sql
-- Exemplo: profiles
CREATE POLICY "Users can view own profile"
  ON profiles FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can update own profile"
  ON profiles FOR UPDATE
  USING (auth.uid() = user_id);
```

---

## Logs e Monitoramento

| Tabela | DescriÃ§Ã£o |
|--------|-----------|
| `erp_sync_logs` | Logs de sincronizaÃ§Ã£o ERP |
| `executive_report_logs` | Envios de relatÃ³rio executivo |
| `stripe_subscription_events` | Eventos do Stripe |
| `credit_usage` | Uso de crÃ©ditos Clara AI |
| `clara_conversations` | HistÃ³rico de interaÃ§Ãµes Clara |
| `clara_feedback` | AvaliaÃ§Ãµes de qualidade |
| `clara_autonomous_actions` | AÃ§Ãµes executadas automaticamente |

---

## PWA

- Configurado via `vite-plugin-pwa`
- Ãcones: `/pwa-192x192.png`, `/pwa-512x512.png`
- Service worker para cache e offline
- Componente `PWAUpdater.tsx` para notificar atualizaÃ§Ãµes

---

## Performance

- **useDashboardData**: RequisiÃ§Ã£o Ãºnica batch para dados do dashboard
- **TanStack Query**: Cache e refetch inteligente
- **Lazy loading**: Componentes pesados carregados sob demanda
- **Realtime seletivo**: Apenas tabelas crÃ­ticas (notifications)
- **Clara Cache**: Respostas frequentes cacheadas por categoria

---

## Arquivos de ConfiguraÃ§Ã£o

| Arquivo | DescriÃ§Ã£o |
|---------|-----------|
| `tailwind.config.ts` | Tema customizado + variÃ¡veis CSS |
| `vite.config.ts` | Build config + PWA |
| `supabase/config.toml` | ConfiguraÃ§Ã£o Supabase |
| `src/config/site.ts` | Links de pagamento + contatos |

---

## Testes

- `vitest` configurado
- Testes de Edge Functions via `supabase--test-edge-functions`
- Arquivos de teste em `src/test/` e `*_test.ts`

---

## Deploy

- **Frontend**: Lovable (auto-deploy no commit)
- **Backend**: Lovable Cloud (Edge Functions auto-deploy)
- **DomÃ­nio Live**: `https://tributechai.lovable.app`
- **Preview**: `https://id-preview--*.lovable.app`

---

## Notas TÃ©cnicas - ReferÃªncias Legadas

### Tabela tributbot_messages
A tabela `tributbot_messages` no banco de dados mantÃ©m o nome original por razÃµes de compatibilidade. 
Esta tabela armazena o histÃ³rico de mensagens da Clara AI. O nome interno nÃ£o afeta a experiÃªncia do usuÃ¡rio.

### Feature Key
A feature key `clara_ai` substituiu `tribubot` em:
- `src/hooks/useFeatureAccess.ts`
- `src/hooks/useUserCredits.ts`

Novos registros usam `clara_ai`, mas registros histÃ³ricos podem conter `tribubot`.

### Redirect Legado
A rota `/tribubot` redireciona automaticamente para `/clara-ai` para manter compatibilidade com links antigos.

---

## EstratÃ©gia AI-Native: Roadmap

### Fase 1: Coleta de Dados âœ…
- [x] Tabelas de memÃ³ria, feedback e conversas
- [x] BotÃµes de thumbs up/down no chat
- [x] ExtraÃ§Ã£o automÃ¡tica de memÃ³rias
- [x] Painel admin Training Data Center
- [x] Export JSONL para fine-tuning

### Fase 2: Agentes Especializados âœ…
- [x] FiscalAgent (crÃ©ditos, NCM, compliance)
- [x] MarginAgent (DRE, pricing, custos)
- [x] ComplianceAgent (prazos, reforma, adequaÃ§Ã£o)
- [x] Router inteligente (keyword + context)
- [x] UI ClaraAgentBadge

### Fase 3: MemÃ³ria Evolutiva âœ…
- [x] Tabela clara_learned_patterns
- [x] Tracking de decisÃµes do usuÃ¡rio
- [x] Sistema de confidence (0.1 â†’ 0.95)
- [x] Decay de relevÃ¢ncia
- [x] Hook useClaraLearning

### Fase 4: AÃ§Ãµes AutÃ´nomas âœ…
- [x] Tabela clara_autonomous_actions
- [x] Sistema de triggers (AUTO_TRIGGERS)
- [x] Fila de aprovaÃ§Ã£o para aÃ§Ãµes de alto impacto
- [x] Status flow (pending â†’ approved â†’ executed)
- [x] UI ClaraAutonomousPanel

### Fase 5: RAG SemÃ¢ntico (PrÃ³ximo)
- [ ] Habilitar pgvector para embeddings
- [ ] Embeddings da knowledge_base
- [ ] Busca semÃ¢ntica em memÃ³rias
- [ ] Threshold de similaridade configurÃ¡vel

### Fase 6: Fine-Tuning
- [ ] Atingir 100+ feedbacks positivos
- [ ] Curar dataset (remover ruÃ­do)
- [ ] Fine-tune modelo especializado
- [ ] A/B test vs modelo base

### Fase 7: OrquestraÃ§Ã£o MCP
- [ ] Model Context Protocol
- [ ] IntegraÃ§Ã£o cross-tool
- [ ] Clara controla ERPs e ferramentas externas
- [ ] UI "invisÃ­vel" (auditoria apenas)
